(this["webpackJsonpunacademy-live"]=this["webpackJsonpunacademy-live"]||[]).push([[20],{"0mD5":function(e,t,i){var r;!function(n,s){"use strict";void 0===(r=function(){var e=function(){var e=function(e){return e.reduce((function(e,t){return 2*e+t}),0)},t=function(e){for(var t=[],i=7;i>=0;i--)t.push(!!(e&1<<i));return t},i=function(e){this.data=e,this.len=this.data.length,this.pos=0,this.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return e instanceof Uint8Array?e[this.pos++]:255&e.charCodeAt(this.pos++)},this.readBytes=function(e){for(var t=[],i=0;i<e;i++)t.push(this.readByte());return t},this.read=function(e){for(var t="",i=0;i<e;i++)t+=String.fromCharCode(this.readByte());return t},this.readUnsigned=function(){var e=this.readBytes(2);return(e[1]<<8)+e[0]}},r=function(i,r){r||(r={});var n=function(e){for(var t=[],r=0;r<e;r++)t.push(i.readBytes(3));return t},s=function(){var e,t;t="";do{e=i.readByte(),t+=i.read(e)}while(0!==e);return t},o=function(o){o.leftPos=i.readUnsigned(),o.topPos=i.readUnsigned(),o.width=i.readUnsigned(),o.height=i.readUnsigned();var a=t(i.readByte());o.lctFlag=a.shift(),o.interlaced=a.shift(),o.sorted=a.shift(),o.reserved=a.splice(0,2),o.lctSize=e(a.splice(0,3)),o.lctFlag&&(o.lct=n(1<<o.lctSize+1)),o.lzwMinCodeSize=i.readByte();var u=s();o.pixels=function(e,t){for(var i,r,n=0,s=function(e){for(var i=0,r=0;r<e;r++)t.charCodeAt(n>>3)&1<<(7&n)&&(i|=1<<r),n++;return i},o=[],a=1<<e,u=a+1,h=e+1,f=[],c=function(){f=[],h=e+1;for(var t=0;t<a;t++)f[t]=[t];f[a]=[],f[u]=null};;)if(r=i,(i=s(h))!==a){if(i===u)break;if(i<f.length)r!==a&&f.push(f[r].concat(f[i][0]));else{if(i!==f.length)throw new Error("Invalid LZW code.");f.push(f[r].concat(f[r][0]))}o.push.apply(o,f[i]),f.length===1<<h&&h<12&&h++}else c();return o}(o.lzwMinCodeSize,u),o.interlaced&&(o.pixels=function(e,t){for(var i=new Array(e.length),r=e.length/t,n=function(r,n){var s=e.slice(n*t,(n+1)*t);i.splice.apply(i,[r*t,t].concat(s))},s=[0,4,2,1],o=[8,8,4,2],a=0,u=0;u<4;u++)for(var h=s[u];h<r;h+=o[u])n(h,a),a++;return i}(o.pixels,o.width)),r.img&&r.img(o)},a=function n(){var a={};switch(a.sentinel=i.readByte(),String.fromCharCode(a.sentinel)){case"!":a.type="ext",function(n){switch(n.label=i.readByte(),n.label){case 249:n.extType="gce",function(n){i.readByte();var s=t(i.readByte());n.reserved=s.splice(0,3),n.disposalMethod=e(s.splice(0,3)),n.userInput=s.shift(),n.transparencyGiven=s.shift(),n.delayTime=i.readUnsigned(),n.transparencyIndex=i.readByte(),n.terminator=i.readByte(),r.gce&&r.gce(n)}(n);break;case 254:n.extType="com",function(e){e.comment=s(),r.com&&r.com(e)}(n);break;case 1:n.extType="pte",function(e){i.readByte();e.ptHeader=i.readBytes(12),e.ptData=s(),r.pte&&r.pte(e)}(n);break;case 255:n.extType="app",function(e){i.readByte();switch(e.identifier=i.read(8),e.authCode=i.read(3),e.identifier){case"NETSCAPE":!function(e){i.readByte();e.unknown=i.readByte(),e.iterations=i.readUnsigned(),e.terminator=i.readByte(),r.app&&r.app.NETSCAPE&&r.app.NETSCAPE(e)}(e);break;default:!function(e){e.appData=s(),r.app&&r.app[e.identifier]&&r.app[e.identifier](e)}(e)}}(n);break;default:n.extType="unknown",function(e){e.data=s(),r.unknown&&r.unknown(e)}(n)}}(a);break;case",":a.type="img",o(a);break;case";":a.type="eof",r.eof&&r.eof(a);break;default:throw new Error("Unknown block: 0x"+a.sentinel.toString(16))}"eof"!==a.type&&setTimeout(n,0)};!function(){var s={};if(s.sig=i.read(3),s.ver=i.read(3),"GIF"!==s.sig)throw new Error("Not a GIF file.");s.width=i.readUnsigned(),s.height=i.readUnsigned();var o=t(i.readByte());s.gctFlag=o.shift(),s.colorRes=e(o.splice(0,3)),s.sorted=o.shift(),s.gctSize=e(o.splice(0,3)),s.bgColor=i.readByte(),s.pixelAspectRatio=i.readByte(),s.gctFlag&&(s.gct=n(1<<s.gctSize+1)),r.hdr&&r.hdr(s)}(),setTimeout(a,0)};return function(e){var t,n,s={vp_l:0,vp_t:0,vp_w:null,vp_h:null,c_w:null,c_h:null,playback_rate:1};for(var o in e)s[o]=e[o];s.vp_w&&s.vp_h&&(s.is_vp=!0);var a=null,u=!1,h=null,f=null,c=null,l=null,d=null,p=null,m=null,y=!0,g=!1,v=[],x=[],E=s.gif;"undefined"==typeof s.auto_play&&(s.auto_play=!E.getAttribute("rel:auto_play")||"1"==E.getAttribute("rel:auto_play"));var w,b,T,_,R=s.hasOwnProperty("on_end")?s.on_end:null,D=s.hasOwnProperty("loop_delay")?s.loop_delay:0,A=s.hasOwnProperty("loop_mode")?s.loop_mode:"auto",P=!s.hasOwnProperty("draw_while_loading")||s.draw_while_loading,N=!!P&&(!s.hasOwnProperty("show_progress_bar")||s.show_progress_bar),B=s.hasOwnProperty("progressbar_height")?s.progressbar_height:25,C=s.hasOwnProperty("progressbar_background_color")?s.progressbar_background_color:"rgba(255,255,255,0.4)",S=s.hasOwnProperty("progressbar_foreground_color")?s.progressbar_foreground_color:"rgba(255,0,22,.8)",F=function(){h=null,f=null,d=c,c=null,p=null},O=function(){try{r(t,W)}catch(e){L("parse")}},U=function(e,t){w.width=e*V(),w.height=t*V(),T.width=e,T.height=t,T.getContext("2d").setTransform(1,0,0,1,0,0)},I=function(e,t,i){if(i&&N){var r,n,o,a=B;s.is_vp?g?(n=(s.vp_t+s.vp_h-a)/V(),a/=V(),r=s.vp_l/V()+e/t*(s.vp_w/V()),o=w.width/V()):(n=s.vp_t+s.vp_h-a,a=a,r=s.vp_l+e/t*s.vp_w,o=w.width):(n=(w.height-a)/(g?V():1),r=e/t*w.width/(g?V():1),o=w.width/(g?V():1),a/=g?V():1),b.fillStyle=C,b.fillRect(r,n,o-r,a),b.fillStyle=S,b.fillRect(0,n,r,a)}},L=function(e){a=e,n={width:E.width,height:E.height},v=[],function(){if(!b){if(!w)return;b=w.getContext("2d")}b.fillStyle="black",b.fillRect(0,0,s.c_w?s.c_w:n.width,s.c_h?s.c_h:n.height),b.strokeStyle="red",b.lineWidth=3,b.moveTo(0,0),b.lineTo(s.c_w?s.c_w:n.width,s.c_h?s.c_h:n.height),b.moveTo(0,s.c_h?s.c_h:n.height),b.lineTo(s.c_w?s.c_w:n.width,0),b.stroke()}()},z=function(){p&&(v.push({data:p.getImageData(0,0,n.width,n.height),delay:f}),x.push({x:0,y:0}))},M=function(){var e=null,t=-1,i=0,r=function(e){t+=e,o()},n=function(){var n=!1,o=function(){i++,!1!==A||i<0?a():(n=!1,y=!1),null!==R&&void 0!==R&&R(E)},a=function i(){if(n=y){r(1);var a=10*v[t].delay;a||(a=100),a/=s.playback_rate,0===(t+1+v.length)%v.length?(a+=D,clearTimeout(e),e=setTimeout(o,a)):(clearTimeout(e),e=setTimeout(i,a))}};return function(){n||(clearTimeout(e),e=setTimeout(a,0))}}(),o=function(){var e;(t=parseInt(t,10))>v.length-1&&(t=0),t<0&&(t=0),e=x[t],_.putImageData(v[t].data,e.x,e.y),b.globalCompositeOperation="copy",b.drawImage(T,0,0)};return{init:function(){a||(clearTimeout(e),s.c_w&&s.c_h||b.scale(V(),V()),s.auto_play?n():(t=0,o()))},clearPlayTimeout:function(){clearTimeout(e)},step:n,play:function(){y=!0,n()},pause:function(){y=!1},playing:y,move_relative:r,current_frame:function(){return t},length:function(){return v.length},duration:function(){for(var e=0,t=0;t<v.length;t++)e+=v[t].delay;return 10*e},move_to:function(e){t=e,o()},seek:function(e){e/=10,t=0;for(var i=0,r=0,n=0;n<v.length;n++){if(!(i+v[n].delay<=e)){r=v[t=n].delay-(e-i);break}i+=v[n].delay}return o(),r}}}(),k=function(e){I(t.pos,t.data.length,e)},G=function(){},X=function(e,t){return function(i){e(i),k(t)}},W={hdr:X((function(e){U((n=e).width,n.height)})),gce:X((function(e){z(),F(),h=e.transparencyGiven?e.transparencyIndex:null,f=e.delayTime,c=e.disposalMethod})),com:X(G),app:{NETSCAPE:X(G)},img:X((function(e){p||(p=_);var t=v.length,i=e.lctFlag?e.lct:n.gct;t>0&&(3===d?null!==l?p.putImageData(v[l].data,0,0):p.clearRect(m.leftPos,m.topPos,m.width,m.height):l=t-1,2===d&&p.clearRect(m.leftPos,m.topPos,m.width,m.height));var r=p.getImageData(e.leftPos,e.topPos,e.width,e.height);e.pixels.forEach((function(e,t){e!==h&&(r.data[4*t+0]=i[e][0],r.data[4*t+1]=i[e][1],r.data[4*t+2]=i[e][2],r.data[4*t+3]=255)})),p.putImageData(r,e.leftPos,e.topPos),g||(b.scale(V(),V()),g=!0),P&&(b.drawImage(T,0,0),P=s.auto_play),m=e}),!0),eof:function(e){z(),k(!1),s.c_w&&s.c_h||(w.width=n.width*V(),w.height=n.height*V()),M.init(),u=!1,Y&&Y(E)}},j=function(){w=document.getElementById("gifBackCanvas"),T=document.getElementById("gifFrontCanvas"),w&&T&&((b=w.getContext("2d")).clearRect(0,0,w.width,w.height),(_=T.getContext("2d")).clearRect(0,0,T.width,T.height),s.c_w&&s.c_h&&U(s.c_w,s.c_h),H=!0)},V=function(){if(s.max_width&&s.max_height&&n){var e=s.max_width/s.max_height;return n.width/n.height<e?s.max_height/n.height:s.max_width/n.width}return 1},H=!1,Y=!1,q=function(e){return!u&&(Y=e||!1,u=!0,v=[],F(),l=null,d=null,p=null,m=null,!0)};return{play:M.play,pause:M.pause,move_relative:M.move_relative,move_to:M.move_to,seek:M.seek,get_playing:function(){return y},get_canvas:function(){return w},get_canvas_scale:function(){return V()},get_loading:function(){return u},get_auto_play:function(){return s.auto_play},get_length:function(){return M.length()},get_duration:function(){return M.duration()},get_current_frame:function(){return M.current_frame()},load_url:function(e,r){if(q(r)){var n=new XMLHttpRequest;n.open("GET",e,!0),"overrideMimeType"in n?n.overrideMimeType("text/plain; charset=x-user-defined"):"responseType"in n?n.responseType="arraybuffer":n.setRequestHeader("Accept-Charset","x-user-defined"),n.onloadstart=function(){H||j()},n.onload=function(e){200!=this.status&&L("xhr - response"),"response"in this||(this.response=new VBArray(this.responseText).toArray().map(String.fromCharCode).join(""));var r=this.response;r.toString().indexOf("ArrayBuffer")>0&&(r=new Uint8Array(r)),t=new i(r),setTimeout(O,0)},n.onprogress=function(e){e.lengthComputable&&I(e.loaded,e.total,!0)},n.onerror=function(){L("xhr")},n.send()}},load:function(e){this.load_url(E.getAttribute("rel:animated_src")||E.src,e)},load_raw:function(e,r){q(r)&&(H||j(),t=new i(e),setTimeout(O,0))},resizeCanvas:function(e,t){s&&(s.max_width=e,s.max_height=t),n&&(w.width=n.width*V(),w.height=n.height*V(),b.scale(V(),V())),M.seek(0)},setPlaybackRate:function(e){s.playback_rate=e},reset:function(){M.clearPlayTimeout()},set_frame_offset:function(e,t){x[e]?("undefined"!==typeof t.x&&(x[e].x=t.x),"undefined"!==typeof t.y&&(x[e].y=t.y)):x[e]=t}}}}();return n.SuperGif||(n.SuperGif=e),e}.call(t,i,t,e))||(e.exports=r)}(window)},"h4/o":function(e,t,i){var r,n,s;!function(o,a){"use strict";n=[i("onF7")],void 0===(s="function"===typeof(r=function(e){e.plugin("chroma",{shader:function(e,t){return t.vertex=["precision mediump float;","attribute vec4 position;","attribute vec2 texCoord;","uniform vec2 resolution;","uniform mat4 transform;","varying vec2 vTexCoord;","uniform vec4 screen;","uniform float balance;","varying float screenSat;","varying vec3 screenPrimary;","void main(void) {","\tfloat fmin = min(min(screen.r, screen.g), screen.b);","\tfloat fmax = max(max(screen.r, screen.g), screen.b);","\tfloat secondaryComponents;","\tscreenPrimary = step(fmax, screen.rgb);","\tsecondaryComponents = dot(1.0 - screenPrimary, screen.rgb);","\tscreenSat = fmax - mix(secondaryComponents - fmin, secondaryComponents / 2.0, balance);","\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);","\tscreenPosition = transform * screenPosition;","\tgl_Position = screenPosition;","\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;","\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);","\tvTexCoord = texCoord;","}"].join("\n"),t.fragment=[this.inputs.mask?"#define MASK":"","precision mediump float;","bool transparentColor = ",this.inputs.transparentColor?"true;":"false;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform vec4 screen;","uniform float screenWeight;","uniform float balance;","uniform float clipBlack;","uniform float clipWhite;","uniform bool mask;","varying float screenSat;","varying vec3 screenPrimary;","void main(void) {","\tfloat pixelSat, secondaryComponents;","\tvec4 sourcePixel = texture2D(source, vTexCoord);","\tfloat fmin = min(min(sourcePixel.r, sourcePixel.g), sourcePixel.b);","\tfloat fmax = max(max(sourcePixel.r, sourcePixel.g), sourcePixel.b);","\tvec3 pixelPrimary = step(fmax, sourcePixel.rgb);","\tsecondaryComponents = dot(1.0 - pixelPrimary, sourcePixel.rgb);","\tpixelSat = fmax - mix(secondaryComponents - fmin, secondaryComponents / 2.0, balance);","\tfloat diffPrimary = dot(abs(pixelPrimary - screenPrimary), vec3(1.0));","\tfloat solid = step(1.0, step(pixelSat, 0.1) + step(fmax, 0.1) + diffPrimary);","\tfloat alpha = max(0.0, 1.0 - pixelSat / screenSat);","\talpha = smoothstep(clipBlack, clipWhite, alpha);","\tvec4 semiTransparentPixel = vec4((sourcePixel.rgb - (1.0 - alpha) * screen.rgb * screenWeight) / max(0.00001, alpha), alpha);","\tvec4 pixel = mix(semiTransparentPixel, sourcePixel, solid);","if(solid == 0.0 && !transparentColor && pixel.a < 0.1)","{","pixel=vec4(0.0,1.0,0.0,1.0);","}","#ifdef MASK","\tgl_FragColor = vec4(vec3(pixel.a), 1.0);","#else","\tgl_FragColor = pixel;","#endif","}"].join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},screen:{type:"color",uniform:"screen",defaultValue:[66/255,195/255,31/255,1]},weight:{type:"number",uniform:"screenWeight",defaultValue:1,min:0},balance:{type:"number",uniform:"balance",defaultValue:1,min:0,max:1},clipBlack:{type:"number",uniform:"clipBlack",defaultValue:0,min:0,max:1},clipWhite:{type:"number",uniform:"clipWhite",defaultValue:1,min:0,max:1},mask:{type:"boolean",defaultValue:!1,uniform:"mask",shaderDirty:!0},transparentColor:{type:"boolean",defaultValue:!0,uniform:"mask",shaderDirty:!0}},title:"Chroma Key",description:""})})?r.apply(t,n):r)||(e.exports=s)}(window)},onF7:function(e,t,i){var r;!function(n,s){"use strict";void 0===(r=function(){var e=function(e){var t,i,r,n,s,o,a,u=e.document,h=e.console,f={},c={},l={},d={},p=[],m={},y={},g={canvas:[],image:[],video:[]},v={},x=e.WeakMap&&new WeakMap,E=0,w=function(){},b={transparent:[0,0,0,0],black:[0,0,0,1],red:[1,0,0,1],green:[0,128/255,0,1],blue:[0,0,1,1],white:[1,1,1,1],silver:[192/255,192/255,192/255,1],gray:[128/255,128/255,128/255,1],maroon:[128/255,0,0,1],purple:[128/255,0,128/255,1],fuchsia:[1,0,1,1],lime:[0,1,0,1],olive:[128/255,128/255,0,1],yellow:[1,1,0,1],navy:[0,0,128/255,1],teal:[0,128/255,128/255,1],aqua:[0,1,1,1],orange:[1,165/255,0,1]},T=/^(rgb|hsl)a?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*(\d+(\.\d*)?)\s*)?\)/i,_=/^#(([0-9a-fA-F]{3,8}))/,R=["x","y","z","w"],D=["r","g","b","a"],A={srcRGB:770,dstRGB:771,srcAlpha:1,dstAlpha:771},P=["MAX_COMBINED_TEXTURE_IMAGE_UNITS","MAX_FRAGMENT_UNIFORM_VECTORS","MAX_TEXTURE_IMAGE_UNITS","MAX_VARYING_VECTORS","MAX_VERTEX_ATTRIBS","MAX_VERTEX_TEXTURE_IMAGE_UNITS","MAX_VERTEX_UNIFORM_VECTORS"],N=/^[\t ]*#define[\t ]+SHADER_NAME\s+([^$\n\r]+)/i,B={frustum:function(e,t,i,r,n,s,o){o||(o=B.create());var a=t-e,u=r-i,h=s-n;return o[0]=2*n/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*n/u,o[6]=0,o[7]=0,o[8]=(t+e)/a,o[9]=(r+i)/u,o[10]=-(s+n)/h,o[11]=-1,o[12]=0,o[13]=0,o[14]=-s*n*2/h,o[15]=0,o},perspective:function(e,t,i,r,n){var s=i*Math.tan(e*Math.PI/360),o=s*t;return B.frustum(-o,o,-s,s,i,r,n)},multiply:function(e,t,i){var r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],u=t[5],h=t[6],f=t[7],c=t[8],l=t[9],d=t[10],p=t[11],m=t[12],y=t[13],g=t[14],v=t[15],x=i[0],E=i[1],w=i[2],b=i[3];return e[0]=x*r+E*a+w*c+b*m,e[1]=x*n+E*u+w*l+b*y,e[2]=x*s+E*h+w*d+b*g,e[3]=x*o+E*f+w*p+b*v,x=i[4],E=i[5],w=i[6],b=i[7],e[4]=x*r+E*a+w*c+b*m,e[5]=x*n+E*u+w*l+b*y,e[6]=x*s+E*h+w*d+b*g,e[7]=x*o+E*f+w*p+b*v,x=i[8],E=i[9],w=i[10],b=i[11],e[8]=x*r+E*a+w*c+b*m,e[9]=x*n+E*u+w*l+b*y,e[10]=x*s+E*h+w*d+b*g,e[11]=x*o+E*f+w*p+b*v,x=i[12],E=i[13],w=i[14],b=i[15],e[12]=x*r+E*a+w*c+b*m,e[13]=x*n+E*u+w*l+b*y,e[14]=x*s+E*h+w*d+b*g,e[15]=x*o+E*f+w*p+b*v,e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}},C=function(){var t=0;return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(i){var r,n,s;return r=(new Date).getTime(),n=Math.max(0,16-(r-t)),s=e.setTimeout((function(){i(r+n)}),n),t=r+n,s}}(),S=e.cancelAnimationFrame||e.webkitCancelAnimationFrame||e.mozCancelAnimationFrame||e.oCancelAnimationFrame||e.msCancelAnimationFrame||function(t){e.cancelTimeout(t)},F=["alias","destroy","effect","id","initialize","inputs","isDestroyed","isReady","matte","off","on","readPixels","render","title","update"],O=["alias","destroy","id","inputs","isDestroyed","isReady","off","on","source","title","update"],U=["aliases","defaults","destroy","effect","go","id","incompatible","isDestroyed","isEffect","isNode","isSource","isTarget","isTransform","removeAlias","render","source","stop","target","transform"];function I(e,t){var i,r;if("string"===typeof e)i=u.querySelector(e);else if(!e)return!1;return e.tagName&&(i=e),i?(r=i.tagName.toLowerCase(),t&&t.indexOf(r)<0?e:i):e}function L(e,t){var i,r;for(i in e.prototype&&t.prototype&&e.prototype!==t.prototype&&L(e.prototype,t.prototype),t)t.hasOwnProperty(i)&&((r=Object.getOwnPropertyDescriptor(t,i)).get||r.set?Object.defineProperty(e,i,{configurable:!0,enumerable:!0,get:r.get,set:r.set}):e[i]=t[i]);return e}function z(e){var t;if(!h)return w;if("function"===typeof h[e])t=h[e];else{if("function"!==typeof h.log)return w;t=h.log}return t.bind?t.bind(h):function(){t.apply(h,arguments)}}function M(t,i){if(i||(i="HTMLElement"),t instanceof e[i])return!0;if(!t||"object"!==typeof t)return!1;for(;t;)if((t=Object.getPrototypeOf(t))&&t.constructor.name===i)return!0;return!1}function k(e,t,i,r,n){function s(e,t,i){return(i%=1)<0&&(i+=1),i<1/6?e+(t-e)*i*6:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}var o,a;return o=2*i-(a=i<.5?i*(t+1):i+t-i*t),n||(n=[]),n[0]=s(o,a,e+1/3),n[1]=s(o,a,e),n[2]=s(o,a,e-1/3),n[3]=r,n}function G(e){var t,i,r,n="#",s=e[3]<1?4:3;for(t=0;t<s;t++)r=(i=Math.min(255,Math.round(255*e[t]||0))).toString(16),i<16&&(r="0"+r),n+=r;return n}function X(e){return Array.isArray(e)||e&&e.BYTES_PER_ELEMENT&&"length"in e}function W(t){if("function"!==typeof t)throw new Error("setTimeoutZero argument is not a function");p.push(t),"file:"!==e.location.protocol?e.postMessage("seriously-timeout-message",e.location):setTimeout((function(){p.length&&p.shift()()}),0)}function j(t,i){var r;try{r=e.WebGLDebugUtils&&i&&i.debugContext?e.WebGLDebugUtils.makeDebugContext(t.getContext("webgl",i)):t.getContext("webgl",i)}catch(n){}if(!r)try{r=t.getContext("experimental-webgl",i)}catch(s){}return r}function V(){var i;return t&&t.getError()===t.CONTEXT_LOST_WEBGL&&(t=void 0),t||!e.WebGLRenderingContext||r||(i=u.createElement("canvas"),(t=j(i))?i.addEventListener("webglcontextlost",(function e(r){r.preventDefault(),t&&t.canvas===this&&(t=void 0,i.removeEventListener("webglcontextlost",e,!1))}),!1):K.logger.warn("Unable to access WebGL.")),t}function H(t){var i,r,n,s;if(!(i=I(t,["img","canvas","video"])))return!1;if(!(r=u.createElement("canvas")))return K.logger.warn("Browser does not support canvas or Seriously.js"),!1;if(0===i.naturalWidth&&"IMG"===i.tagName)return K.logger.warn("Image not loaded"),!1;if(0===i.readyState&&0===i.videoWidth&&"VIDEO"===i.tagName)return K.logger.warn("Video not loaded"),!1;if(n=V()){(s=n.createTexture())||K.logger.error("Test WebGL context has been lost"),n.bindTexture(n.TEXTURE_2D,s);try{n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,i)}catch(o){return o.code===e.DOMException.SECURITY_ERR?K.logger.log("Unable to access cross-domain image"):K.logger.error("Error storing image to texture: "+o.message),n.deleteTexture(s),!1}n.deleteTexture(s)}else{n=r.getContext("2d");try{n.drawImage(i,0,0),n.getImageData(0,0,1,1)}catch(a){return a.code===e.DOMException.SECURITY_ERR?K.logger.log("Unable to access cross-domain image"):K.logger.error("Error drawing image to canvas: "+a.message),!1}}return!0}function Y(e){var t,i,r;function n(e,r){var n,s;X(e)?(n=e[0],s=e[1]||n):n=e,"string"===typeof n?n=n.toLowerCase():"number"===typeof n?n=String(n):n||(n=""),i[n]=s,r||(t.firstValue=n)}function s(e){return e}for(r in e.inputs)if(e.inputs.hasOwnProperty(r)){if(e.reserved.indexOf(r)>=0||Object.prototype[r])throw new Error("Reserved input name: "+r);(t=e.inputs[r]).name=r,isNaN(t.min)&&(t.min=-1/0),isNaN(t.max)&&(t.max=1/0),isNaN(t.minCount)&&(t.minCount=-1/0),isNaN(t.maxCount)&&(t.maxCount=1/0),isNaN(t.step)&&(t.step=0),isNaN(t.mod)&&(t.mod=0),"enum"===t.type&&t.options&&X(t.options)&&t.options.length&&(i={},t.options.forEach(n),t.options=i),"vector"===t.type?t.dimensions<2?t.dimensions=2:t.dimensions>4||!t.dimensions||isNaN(t.dimensions)?t.dimensions=4:t.dimensions=Math.round(t.dimensions):t.dimensions=1,t.shaderDirty=!!t.shaderDirty,"function"!==typeof t.validate&&(t.validate=K.inputValidators[t.type]||s),e.defaultImageInput||"image"!==t.type||(e.defaultImageInput=r)}}function q(e,t,i,r){var n,s,o,a;!0===r||r&&r.useFloat;this.type=e.UNSIGNED_BYTE,n=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,n),r&&r.texture?(this.texture=r.texture,e.bindTexture(e.TEXTURE_2D,this.texture),this.ownTexture=!1):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.ownTexture=!0);try{this.type===e.FLOAT?(o=new Float32Array(t*i*4),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,i,0,e.RGBA,e.FLOAT,o)):(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,i,0,e.RGBA,e.UNSIGNED_BYTE,null),this.type=e.UNSIGNED_BYTE)}catch(u){this.type=e.UNSIGNED_BYTE,o=new Uint8Array(t*i*4),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,i,0,e.RGBA,e.UNSIGNED_BYTE,o)}if(s=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,s),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t,i),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,s),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0),(a=e.checkFramebufferStatus(e.FRAMEBUFFER))===e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT)throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");if(a===e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT)throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");if(a===e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS)throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");if(a===e.FRAMEBUFFER_UNSUPPORTED)throw new Error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");if(a!==e.FRAMEBUFFER_COMPLETE)throw new Error("Incomplete framebuffer: "+a);e.bindTexture(e.TEXTURE_2D,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),this.gl=e,this.frameBuffer=n,this.renderBuffer=s,this.width=t,this.height=i}function Z(e,t,i){var r,n,s,o,a,u,h,f,c="";function l(t,i){var r,n;if(r=i?e.createShader(e.FRAGMENT_SHADER):e.createShader(e.VERTEX_SHADER),e.shaderSource(r,t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){for(t=t.split(/[\n\r]/),n=0;n<t.length;n++)t[n]=n+1+":\t"+t[n];throw t.unshift("Error compiling "+(i?"fragment":"vertex")+" shader:"),K.logger.error(t.join("\n")),new Error("Shader error: "+e.getShaderInfoLog(r))}return r}function d(t,i){if(t.type===e.SAMPLER_2D)return function(r){t.glTexture=e["TEXTURE"+r],e.uniform1i(i,r)};if(t.type===e.BOOL||t.type===e.INT)return t.size>1?function(t){e.uniform1iv(i,t)}:function(t){e.uniform1i(i,t)};if(t.type===e.FLOAT)return t.size>1?function(t){e.uniform1fv(i,t)}:function(t){e.uniform1f(i,t)};if(t.type===e.FLOAT_VEC2)return function(t){e.uniform2f(i,t[0],t[1])};if(t.type===e.FLOAT_VEC3)return function(t){e.uniform3f(i,t[0],t[1],t[2])};if(t.type===e.FLOAT_VEC4)return function(t){e.uniform4f(i,t[0],t[1],t[2],t[3])};if(t.type===e.FLOAT_MAT3)return function(t){e.uniformMatrix3fv(i,!1,t)};if(t.type===e.FLOAT_MAT4)return function(t){e.uniformMatrix4fv(i,!1,t)};throw new Error("Unknown shader uniform type: "+t.type)}function p(t){return function(){return e.getUniform(r,t)}}if(n=l(t),s=l(i,!0),r=e.createProgram(),e.attachShader(r,n),(o=e.getShaderInfoLog(n))&&(c+="Vertex shader error: "+o+"\n"),e.attachShader(r,s),(o=e.getShaderInfoLog(s))&&(c+="Fragment shader error: "+o+"\n"),e.linkProgram(r),!e.getProgramParameter(r,e.LINK_STATUS))throw c+=e.getProgramInfoLog(r),e.deleteProgram(r),e.deleteShader(n),e.deleteShader(s),(h=N.exec(t)||N.exec(i))&&(c="Shader = "+h[1]+"\n"+c),P.forEach((function(t){c+="\n"+t+": "+e.getParameter(e[t])})),new Error("Could not initialize shader:\n"+c);for(e.useProgram(r),this.uniforms={},u=e.getProgramParameter(r,e.ACTIVE_UNIFORMS),a=0;a<u;++a)(f={info:e.getActiveUniform(r,a)}).name=f.info.name.replace(/\[0\]$/,""),f.loc=e.getUniformLocation(r,f.name),f.set=d(f.info,f.loc),f.get=p(f.loc),this.uniforms[f.name]=f,this[f.name]||(this[f.name]=f);for(this.attributes={},this.location={},u=e.getProgramParameter(r,e.ACTIVE_ATTRIBUTES),a=0;a<u;++a)(f={info:e.getActiveAttrib(r,a)}).name=f.info.name,f.location=e.getAttribLocation(r,f.name),this.attributes[f.name]=f,this.location[f.name]=f.location;this.gl=e,this.program=r,this.destroy=function(){var t;for(t in e&&(e.deleteProgram(r),e.deleteShader(n),e.deleteShader(s)),this)this.hasOwnProperty(t)&&delete this[t];r=null,n=null,s=null}}function K(t){if(e===this||!(this instanceof K)||void 0!==this.id)return new K(t);var i,r,s,h,p,v,b,T,_,R,D,P,F,O,z,k=++E,X=this,V=[],H={},J=0,$=[],Q=[],ee=[],te=[],ie={},re=[],ne=[],se={},oe={},ae=!1,ue=!1;function he(e,t){var i,r,n;return!!t&&(i=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,e.vertices,t.STATIC_DRAW),i.size=3,r=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e.indices,t.STATIC_DRAW),n=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,e.coords,t.STATIC_DRAW),n.size=2,{vertex:i,index:r,texCoord:n,length:e.indices.length,mode:e.mode||t.TRIANGLES})}function fe(e){var t={};return t.vertices=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0]),t.indices=new Uint16Array([0,1,2,0,2,3]),t.coords=new Float32Array([0,0,1,0,1,1,0,1]),he(t,e)}function ce(e){var t,n;if(!r)if(e.canvas.addEventListener("webglcontextlost",de,!1),e.canvas.addEventListener("webglcontextrestored",le,!1),e.isContextLost())K.logger.warn("Unable to attach lost WebGL context. Will try again when context is restored.");else{for(r=e,i=e.canvas,h=fe(r),p=new Z(r,"#define SHADER_NAME seriously.base\n"+o,"#define SHADER_NAME seriously.base\n"+a),t=0;t<te.length;t++)(n=te[t]).gl=r,n.initialize(),n.buildShader();for(t=0;t<$.length;t++)(n=$[t]).initialize();for(t=0;t<Q.length;t++)(n=Q[t]).model||(n.model=h,n.shader=p)}}function le(){var e,t,i,n;if(s&&!r){if(M(t=s.target,"WebGLFramebuffer"))return void K.logger.error("Unable to restore target built on WebGLFramebuffer");if(e=j(t,{alpha:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!0,stencil:!0,debugContext:s.debugContext})){if(e.isContextLost())return void K.logger.error("Unable to restore WebGL Context");for(ce(e),s.renderToTexture?s.frameBuffer=new q(r,s.width,s.height,!1):s.frameBuffer={frameBuffer:null},i=0;i<V.length;i++)(n=V[i]).setDirty(),n.emit("webglcontextrestored");K.logger.log("WebGL context restored")}}}function de(e){var t,n;for(e&&(K.logger.warn("WebGL context lost"),e.preventDefault()),z&&(S(z),z=0),i&&i.removeEventListener("webglcontextlost",de,!1),t=0;t<te.length;t++)(n=te[t]).gl=null,n.initialized=!1,n.baseShader=null,n.model=null,n.frameBuffer=null,n.texture=null,n.shader&&n.shader.destroy&&(n.shader.destroy(),n.effect.commonShader&&delete oe[n.hook]),n.shaderDirty=!0,n.shader=null,n.effect.lostContext&&n.effect.lostContext.call(n),e&&n.emit("webglcontextlost");for(t=0;t<$.length;t++)(n=$[t]).texture=null,n.initialized=!1,n.allowRefresh=!1,e&&n.emit("webglcontextlost");for(t=0;t<ee.length;t++)(n=ee[t]).frameBuffer=null,n.texture=null,e&&n.emit("webglcontextlost");for(t=0;t<Q.length;t++)(n=Q[t]).model=!1,n.frameBuffer=null,e&&n.emit("webglcontextlost");p&&p.destroy&&p.destroy(),r&&(r.deleteBuffer(h.vertex),r.deleteBuffer(h.texCoord),r.deleteBuffer(h.index)),h&&(delete h.vertex,delete h.texCoord,delete h.index),h=null,p=null,r=null,i=null}function pe(e){var t,i,r=!1;if(z=0,re.length)for(r=!0,t=0;t<re.length;t++)re[t].call(X,e);if($&&$.length)for(r=!0,t=0;t<$.length;t++)((i=$[t]).dirty||i.checkDirty&&i.checkDirty())&&(i.dirty=!1,i.setDirty());for(t=0;t<Q.length;t++)(i=Q[t]).auto&&i.dirty&&i.render();if(ne.length)for(r=!0,t=0;t<ne.length;t++)ne[t].call(X);r&&!z&&(z=C(pe))}function me(e,t,i,n,s,o){var a,u,h,f,c,l,d,p,m,y=0,g=s&&s.gl||r;if(g){for(a in s?(f=o&&o.width||s.width||g.canvas.width,c=o&&o.height||s.height||g.canvas.height):(f=o&&o.width||g.canvas.width,c=o&&o.height||g.canvas.height),e.use(),g.viewport(0,0,f,c),g.bindFramebuffer(g.FRAMEBUFFER,n),g.enableVertexAttribArray(e.location.position),g.enableVertexAttribArray(e.location.texCoord),t.texCoord&&(g.bindBuffer(g.ARRAY_BUFFER,t.texCoord),g.vertexAttribPointer(e.location.texCoord,t.texCoord.size,g.FLOAT,!1,0,0)),g.bindBuffer(g.ARRAY_BUFFER,t.vertex),g.vertexAttribPointer(e.location.position,t.vertex.size,g.FLOAT,!1,0,0),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,t.index),o&&o.depth?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),o?void 0===o.blend||o.blend?(r.enable(r.BLEND),l=void 0===o.srcRGB?r.ONE:o.srcRGB,p=o.dstRGB||r.ZERO,d=void 0===o.srcAlpha?l:o.srcAlpha,m=void 0===o.dstAlpha?p:o.dstAlpha,r.blendFuncSeparate(l,p,d,m),r.blendEquation(o.blendEquation||r.FUNC_ADD)):r.disable(r.BLEND):(r.enable(r.BLEND),r.blendFunc(r.ONE,r.ZERO),r.blendEquation(r.FUNC_ADD)),i)i.hasOwnProperty(a)&&(u=i[a],(h=e.uniforms[a])&&(M(u,"WebGLTexture")?(g.activeTexture(g.TEXTURE0+y),g.bindTexture(g.TEXTURE_2D,u),h.set(y),y++):u instanceof b||u instanceof T||u instanceof _?u.texture&&(g.activeTexture(g.TEXTURE0+y),g.bindTexture(g.TEXTURE_2D,u.texture),h.set(y),y++):void 0!==u&&null!==u&&h.set(u)));o&&void 0!==o.clear&&!o.clear||(g.clearColor(0,0,0,0),g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT)),g.drawElements(t.mode,t.length,g.UNSIGNED_SHORT,0),r.enable(r.DEPTH_TEST)}}function ye(e,t,i){var r,n;if(("string"!==typeof e||!t&&0!==t)&&(i&&"object"===typeof i||(i=t),t=e),"string"===typeof e&&l[e]||(e=null),t instanceof b||t instanceof T||t instanceof _)r=t;else if(t instanceof D||t instanceof P||t instanceof F){if(!(r=H[t.id]))throw new Error("Cannot connect a foreign node")}else{for("string"===typeof t&&isNaN(t)&&(t=I(t,["canvas","img","video"])),n=0;n<$.length;n++)if(r=$[n],(!e||e===r.hook)&&r.compare&&r.compare(t,i))return r;r=new b(e,t,i)}return r}function ge(e,t){var i,r,n;if(!(e instanceof T)&&!(e instanceof _))return!1;if(e===t)return!0;for(i in n=e.sources)if(n.hasOwnProperty(i)&&((r=n[i])===t||ge(r,t)))return!0;return!1}(v=function(){this.ready=!1,this.width=1,this.height=1,this.gl=r,this.uniforms={resolution:[this.width,this.height],transform:null},this.dirty=!0,this.isDestroyed=!1,this.seriously=X,this.listeners={},this.id=J,J++}).prototype.setReady=function(){var e;if(!this.ready&&(this.ready=!0,this.emit("ready"),this.targets))for(e=0;e<this.targets.length;e++)this.targets[e].setReady()},v.prototype.setUnready=function(){var e;if(this.ready&&(this.ready=!1,this.emit("unready"),this.targets))for(e=0;e<this.targets.length;e++)this.targets[e].setUnready()},v.prototype.setDirty=function(){var e;if(!this.dirty&&(this.emit("dirty"),this.dirty=!0,this.targets))for(e=0;e<this.targets.length;e++)this.targets[e].setDirty()},v.prototype.initFrameBuffer=function(e){r&&(this.frameBuffer=new q(r,this.width,this.height,e))},v.prototype.readPixels=function(e,t,i,n,s){var o=this.gl||r;if(!r)throw new Error("Cannot read pixels until a canvas is connected");if(this.frameBuffer||(this.initFrameBuffer(),this.setDirty()),this.render(),void 0===s)s=new Uint8Array(i*n*4);else if(!M(s,"Uint8Array"))throw new Error("Incompatible array type");return o.bindFramebuffer(r.FRAMEBUFFER,this.frameBuffer.frameBuffer),o.readPixels(e,t,i,n,r.RGBA,r.UNSIGNED_BYTE,s),s},v.prototype.resize=function(){var e,t;this.source?(e=this.source.width,t=this.source.height):this.sources&&this.sources.source?(e=this.sources.source.width,t=this.sources.source.height):this.inputs&&this.inputs.width?(e=this.inputs.width,t=this.inputs.height||e):this.inputs&&this.inputs.height?e=t=this.inputs.height:(e=1,t=1),e=Math.floor(e),t=Math.floor(t),this.width===e&&this.height===t||(this.width=e,this.height=t,this.emit("resize"),this.setDirty()),this.uniforms&&this.uniforms.resolution&&(this.uniforms.resolution[0]=e,this.uniforms.resolution[1]=t),this.frameBuffer&&this.frameBuffer.resize&&this.frameBuffer.resize(e,t)},v.prototype.on=function(e,t){var i,r=-1;e&&"function"===typeof t&&((i=this.listeners[e])?r=i.indexOf(t):i=this.listeners[e]=[],r<0&&i.push(t))},v.prototype.off=function(e,t){var i,r=-1;e&&"function"===typeof t&&(i=this.listeners[e])&&(r=i.indexOf(t))>=0&&i.splice(r,1)},v.prototype.emit=function(e){var t,i=this.listeners[e];if(i&&i.length)for(t=0;t<i.length;t++)W(i[t])},v.prototype.destroy=function(){var e,t;for(t in delete this.gl,delete this.seriously,this.listeners)this.listeners.hasOwnProperty(t)&&delete this.listeners[t];for(e in this.uniforms)this.uniforms.hasOwnProperty(e)&&delete this.uniforms[e];this.targets&&delete this.targets,this.frameBuffer&&this.frameBuffer.destroy&&(this.frameBuffer.destroy(),delete this.frameBuffer),(e=V.indexOf(this))>=0&&V.splice(e,1),delete H[this.id],this.isDestroyed=!0},D=function(e){var t,i=e;function r(e,t){var r,n,s;return s=i.effect.inputs[e],r=i.inputElements[e],"string"===typeof t&&isNaN(t)&&("enum"===s.type?s.options.hasOwnProperty(t)||(t=I(t,["select"])):"number"===s.type||"boolean"===s.type?t=I(t,["input","select"]):"image"===s.type&&(t=I(t,["canvas","img","video"]))),M(t,"HTMLInputElement")||M(t,"HTMLSelectElement")?(n=t.value,r&&r.element!==t&&(r.element.removeEventListener("change",r.listener,!0),r.element.removeEventListener("input",r.listener,!0),delete i.inputElements[e],r=null),r||(r={element:t,listener:function(e,r){return function(){var n,o;n="checkbox"===t.type?t.checked:r.value,o=i.setInput(e,n),"color"===s.type&&(o=G(o).substr(0,7)),o!==n&&(r.value=o)}}(e,t)},i.inputElements[e]=r,"range"===t.type?(t.addEventListener("input",r.listener,!0),t.addEventListener("change",r.listener,!0)):t.addEventListener("change",r.listener,!0)),r&&"checkbox"===t.type&&(n=t.checked)):(r&&(r.element.removeEventListener("change",r.listener,!0),r.element.removeEventListener("input",r.listener,!0),delete i.inputElements[e]),n=t),i.setInput(e,n),i.inputs[e]}function n(e){return function(t){var i=r(e,t);return i&&i.pub}}function s(e){return function(){var t=i.inputs[e];return t&&t.pub}}function o(e){return function(t){return r(e,t)}}function a(e){return function(){return i.inputs[e]}}for(t in i.effect.inputs)if(i.effect.inputs.hasOwnProperty(t)){if(void 0!==this[t])throw new Error("Cannot overwrite Seriously."+t);"image"===i.effect.inputs[t].type?Object.defineProperty(this,t,{configurable:!0,enumerable:!0,get:s(t),set:n(t)}):Object.defineProperty(this,t,{configurable:!0,enumerable:!0,get:a(t),set:o(t)})}Object.defineProperties(this,{effect:{enumerable:!0,configurable:!0,get:function(){return i.hook}},title:{enumerable:!0,configurable:!0,get:function(){return i.effect.title||i.hook}},width:{enumerable:!0,configurable:!0,get:function(){return i.width}},height:{enumerable:!0,configurable:!0,get:function(){return i.height}},id:{enumerable:!0,configurable:!0,get:function(){return i.id}}}),this.render=function(){return i.render(),this},this.readPixels=function(e,t,r,n,s){return i.readPixels(e,t,r,n,s)},this.on=function(e,t){i.on(e,t)},this.off=function(e,t){i.off(e,t)},this.inputs=function(e){var t,r,n,s;if(n=i.effect.inputs,e)return(r=n[e])?(t={type:r.type,defaultValue:r.defaultValue,title:r.title||e},"number"===r.type?(t.min=r.min,t.max=r.max,t.step=r.step,t.mod=r.mod):"enum"===r.type?t.options=L({},r.options):"vector"===r.type&&(t.dimensions=r.dimensions),r.description&&(t.description=r.description),t):null;for(s in t={},n)n.hasOwnProperty(s)&&(t[s]=this.inputs(s));return t},this.alias=function(e,t){return i.alias(e,t),this},this.matte=function(e){i.matte(e)},this.destroy=function(){var e,t;for(e in i.destroy(),this)this.hasOwnProperty(e)&&"isDestroyed"!==e&&"id"!==e&&((t=Object.getOwnPropertyDescriptor(this,e)).get||t.set||"function"!==typeof this[e]?delete this[e]:this[e]=w)},this.isDestroyed=function(){return i.isDestroyed},this.isReady=function(){return i.ready}},(T=function(e,t){var i,s,o,a,u={};for(i in v.call(this,t),this.gl=r,this.effectRef=f[e],this.sources={},this.targets=[],this.inputElements={},this.dirty=!0,this.shaderDirty=!0,this.hook=e,this.options=t,this.transform=null,this.effect=L({},this.effectRef),this.effectRef.definition&&L(this.effect,this.effectRef.definition.call(this,t)),Y(this.effect),this.uniforms.transform=n,this.inputs={},a=se[e],this.effect.inputs)this.effect.inputs.hasOwnProperty(i)&&(void 0!==(s=this.effect.inputs[i]).defaultValue&&null!==s.defaultValue||("number"===s.type?s.defaultValue=Math.min(Math.max(0,s.min),s.max):"color"===s.type?s.defaultValue=[0,0,0,0]:"boolean"===s.type?s.defaultValue=!1:"string"===s.type?s.defaultValue="":"enum"===s.type&&(s.defaultValue=s.firstValue)),o=s.validate.call(this,s.defaultValue,s),a&&void 0!==a[i]&&(o=s.validate.call(this,a[i],s,s.defaultValue,o),a[i]=o,"image"===s.type&&(u[i]=o)),this.inputs[i]=o,s.uniform&&(this.uniforms[s.uniform]=s.defaultValue));for(i in r&&(this.initialize(),this.effect.commonShader&&this.buildShader()),this.updateReady(),this.inPlace=this.effect.inPlace,this.pub=new D(this),V.push(this),H[this.id]=this,te.push(this),m[e].push(this),u)u.hasOwnProperty(i)&&this.setInput(i,u[i])}).prototype=Object.create(v.prototype),T.prototype.constructor=T,T.prototype.initialize=function(){if(!this.initialized){var e=this;this.baseShader=p,this.shape?this.model=he(this.shape,this.gl):this.model=h,"function"===typeof this.effect.initialize?this.effect.initialize.call(this,(function(){e.initFrameBuffer(!0)}),r):this.initFrameBuffer(!0),this.frameBuffer&&(this.texture=this.frameBuffer.texture),this.initialized=!0}},T.prototype.resize=function(){var e;for(v.prototype.resize.call(this),this.effect.resize&&this.effect.resize.call(this),e=0;e<this.targets.length;e++)this.targets[e].resize()},T.prototype.updateReady=function(){var e,t,i,r,n=!0;for(t in(i=this.effect).inputs)if(i.inputs.hasOwnProperty(t)&&"image"===this.effect.inputs[t].type&&(!this.sources[t]||!this.sources[t].ready)&&(!i.requires||i.requires.call(this,t,this.inputs))){n=!1;break}if(this.ready!==n&&(this.ready=n,this.emit(n?"ready":"unready"),r=n?"setReady":"setUnready",this.targets))for(e=0;e<this.targets.length;e++)this.targets[e][r]()},T.prototype.setReady=T.prototype.updateReady,T.prototype.setUnready=T.prototype.updateReady,T.prototype.addTarget=function(e){var t;for(t=0;t<this.targets.length;t++)if(this.targets[t]===e)return;this.targets.push(e)},T.prototype.removeTarget=function(e){var t=this.targets&&this.targets.indexOf(e);t>=0&&this.targets.splice(t,1)},T.prototype.removeSource=function(e){var t,i=e&&e.pub;for(t in this.inputs)!this.inputs.hasOwnProperty(t)||this.inputs[t]!==e&&this.inputs[t]!==i||(this.inputs[t]=null);for(t in this.sources)!this.sources.hasOwnProperty(t)||this.sources[t]!==e&&this.sources[t]!==i||(this.sources[t]=null)},T.prototype.buildShader=function(){var e,t=this.effect,i=this;function n(e){return N.test(e)?e:"#define SHADER_NAME seriously."+i.hook+"\n"+e}this.shaderDirty&&(t.commonShader&&oe[this.hook]?(this.shader||oe[this.hook].count++,this.shader=oe[this.hook].shader):t.shader?(this.shader&&!t.commonShader&&this.shader.destroy(),(e=t.shader.call(this,this.inputs,{vertex:o,fragment:a},K.util))instanceof Z?this.shader=e:e&&e.vertex&&e.fragment?this.shader=new Z(r,n(e.vertex),n(e.fragment)):this.shader=p,t.commonShader&&(oe[this.hook]={count:1,shader:this.shader})):this.shader=p,this.shaderDirty=!1)},T.prototype.render=function(){var e,t,i,n=this.effect,s=this;if(r){if(this.initialized||this.initialize(),this.shaderDirty&&this.buildShader(),this.dirty&&this.ready){for(e in this.sources)!this.sources.hasOwnProperty(e)||n.requires&&!n.requires.call(this,e,this.inputs)||(i="function"===typeof this.inPlace?this.inPlace(e):this.inPlace,this.sources[e].render(!i));this.frameBuffer&&(t=this.frameBuffer.frameBuffer),"function"===typeof n.draw?(n.draw.call(this,this.shader,this.model,this.uniforms,t,(function(e,t,i,r,n,o){me(e,t,i,r,n||s,o)})),this.emit("render")):t&&(me(this.shader,this.model,this.uniforms,t,this),this.emit("render")),this.dirty=!1}return this.texture}},T.prototype.setInput=function(e,t){var i,r,s,o,a,u=this;if(this.effect.inputs.hasOwnProperty(e)){if("image"===(i=this.effect.inputs[e]).type){if(t){if((t=ye(t))!==this.sources[e]){if(function(){var t,i=u.sources[e];if(i){for(t in u.sources)if(t!==e&&u.sources.hasOwnProperty(t)&&u.sources[t]===i)return;i.removeTarget(u)}}(),ge(t,this))throw new Error("Attempt to make cyclical connection.");this.sources[e]=t,t.addTarget(this)}}else delete this.sources[e],t=!1;r=this.sources[e],s=Object.keys(this.sources),!0===this.inPlace&&1===s.length?(o=this.sources[s[0]],this.uniforms.transform=o&&o.cumulativeMatrix||n):this.uniforms.transform=n}else a=se[this.hook]&&void 0!==se[this.hook][e]?se[this.hook][e]:i.defaultValue,r=t=i.validate.call(this,t,i,a,this.inputs[e]);return this.inputs[e]===t&&"color"!==i.type&&"vector"!==i.type||(this.inputs[e]=t,i.uniform&&(this.uniforms[i.uniform]=r),"image"===i.type?(this.resize(),this.updateReady()):i.updateSources&&this.updateReady(),i.shaderDirty&&(this.shaderDirty=!0),this.setDirty(),i.update&&i.update.call(this,t)),t}},T.prototype.alias=function(e,t){var i=this;if(U.indexOf(t)>=0)throw new Error("'"+t+"' is a reserved name and cannot be used as an alias.");return this.effect.inputs.hasOwnProperty(e)&&(t||(t=e),X.removeAlias(t),ie[t]={node:this,input:e},Object.defineProperty(X,t,{configurable:!0,enumerable:!0,get:function(){return i.inputs[e]},set:function(t){return i.setInput(e,t)}})),this},T.prototype.matte=function(e){var t,i,r,n,s,o,a,u=[],h=[],f={};function c(e,t,i,r){var n,s,o,a,u;return n=(r.x-i.x)*(e.y-i.y)-(r.y-i.y)*(e.x-i.x),s=(t.x-e.x)*(e.y-i.y)-(t.y-e.y)*(e.x-i.x),!!((o=(r.y-i.y)*(t.x-e.x)-(r.x-i.x)*(t.y-e.y))&&(u=s/o,(a=n/o)>0&&a<=1&&u>0&&u<=1))&&{x:e.x+a*(t.x-e.x),y:e.y+a*(t.y-e.y)}}function l(e){var t,i,r,n,s,o,a,f,l,d,p,m=[];if(!e.simple){for(t=0;t<e.edges.length;t++)for(r=e.edges[t],i=t+1;i<e.edges.length;i++)n=e.edges[i],(s=c(r[0],r[1],n[0],n[1]))&&(s.edge1=r,s.edge2=n,m.push(s));if(m.length){for(l=[],t=0;t<m.length;t++)r=(s=m[t]).edge1,n=s.edge2,d={x:s.x,y:s.y,prev:r[0],next:n[1],id:h.length},e.vertices.push(d),h.push(d),p={x:s.x,y:s.y,prev:n[0],next:r[1],id:h.length},e.vertices.push(p),h.push(d),d.prev.next=d,d.next.prev=d,p.prev.next=p,p.next.prev=p;do{o={edges:[],vertices:[],simple:!0},l.push(o),a=f=e.vertices[0];do{t=e.vertices.indexOf(f),e.vertices.splice(t,1),o.edges.push([f,f.next]),o.vertices.push(f),f=f.next}while(f!==a)}while(e.vertices.length);for(t=u.indexOf(e),u.splice(t,1),t=0;t<l.length;t++)u.push(l[t])}else e.simple=!0}}function d(e){var t,i,r,n,s=e.vertices.length,o=0;for(t=s-1,i=0;i<s;t=i,i++)r=e.vertices[t],n=e.vertices[i],o+=r.x*n.y-n.x*r.y;return o>0}function p(e){var t,r,n,s,o,a,u,h,f,c,l,d=e.vertices,p=[],m=[];function y(e,t,i,r){var n,s,o,a,u,h,f,c,l,d,p,m;return n=i.x-t.x,s=i.y-t.y,o=e.x-i.x,a=e.y-i.y,u=t.x-e.x,h=t.y-e.y,f=r.x-e.x,c=r.y-e.y,l=r.x-t.x,d=r.y-t.y,p=r.x-i.x,m=r.y-i.y,n*d-s*l>=0&&o*m-a*p>=0&&u*c-h*f>=0}function g(e,t,i,r,n){var s,o,a,u;if(o=d[n[e]],a=d[n[t]],u=d[n[i]],0>(a.x-o.x)*(u.y-o.y)-(a.y-o.y)*(u.x-o.x))return!1;for(s=0;s<r;s++)if(s!==e&&s!==t&&s!==i&&y(o,a,u,d[n[s]]))return!1;return!0}if(r=d.length,e.clockWise)for(t=0;t<r;t++)p[t]=t;else for(t=0;t<r;t++)p[t]=r-1-t;for(s=2*(n=r),0,t=n-1;n>2;){if(s--<=0)return m;if(n<=(o=t)&&(o=0),n<=(t=o+1)&&(t=0),n<(a=t+1)&&(a=0),g(o,t,a,n,p)){for(u=p[o],h=p[t],f=p[a],e.clockWise?(m.push(d[u]),m.push(d[h]),m.push(d[f])):(m.push(d[f]),m.push(d[h]),m.push(d[u])),c=t,l=t+1;l<n;c++,l++)p[c]=p[l];s=2*--n}}i.indices=m}for(t=function(e){return e&&e.length&&Array.isArray(e)?Array.isArray(e[0])?Array.isArray(e[0])&&!isNaN(e[0][0])?[e]:e:[e]:[]}(e),r=0;r<t.length;r++){for(e=t[r],a=null,i={vertices:[],edges:[]},n=0;n<e.length;n++)"object"!==typeof(s=e[n])||isNaN(s.x)||isNaN(s.y)?s.length>=2&&!isNaN(s[0])&&!isNaN(s[1])&&(o={x:s[0],y:s[1],id:h.length}):o={x:s.x,y:s.y,id:h.length},o&&(a?(a.next=o,o.prev=a,o.next=i.vertices[0],i.vertices[0].prev=o):(i.head=o,o.next=o,o.prev=o),h.push(o),i.vertices.push(o),a=o);if(i.vertices.length>2)for(3===i.vertices.length&&(i.simple=!0),u.push(i),n=0;n<i.vertices.length;n++)o=i.vertices[n],i.edges.push([o,o.next])}for(r=u.length-1;r>=0;r--)l(i=u[r]);for(r=0;r<u.length;r++)(i=u[r]).clockWise=d(i),p(i);for(f.vertices=[],f.coords=[],r=0;r<h.length;r++)s=h[r],f.vertices.push(2*s.x-1),f.vertices.push(-2*s.y+1),f.vertices.push(-1),f.coords.push(s.x),f.coords.push(-1*s.y+1);for(f.vertices=new Float32Array(f.vertices),f.coords=new Float32Array(f.coords),f.indices=[],r=0;r<u.length;r++)for(i=u[r],n=0;n<i.indices.length;n++)s=i.indices[n],f.indices.push(s.id);f.indices=new Uint16Array(f.indices),this.shape=f,this.gl&&he(f,this.gl)},T.prototype.destroy=function(){var e,t,i,r=this.hook;for(t in this.effect.destroy&&"function"===typeof this.effect.destroy&&this.effect.destroy.call(this),delete this.effect,oe[r]&&(oe[r].count--,oe[r].count||delete oe[r]),this.shader&&this.shader.destroy&&this.shader!==p&&!oe[r]&&this.shader.destroy(),delete this.shader,this.inputElements)this.inputElements.hasOwnProperty(t)&&((i=this.inputElements[t]).element.removeEventListener("change",i.listener,!0),i.element.removeEventListener("input",i.listener,!0));for(t in this.sources)this.sources.hasOwnProperty(t)&&((i=this.sources[t])&&i.removeTarget&&i.removeTarget(this),delete this.sources[t]);for(;this.targets.length;)(i=this.targets.pop())&&i.removeSource&&i.removeSource(this);for(t in this)this.hasOwnProperty(t)&&"id"!==t&&delete this[t];for(t in ie)ie.hasOwnProperty(t)&&(i=ie[t]).node===this&&X.removeAlias(t);(e=te.indexOf(this))>=0&&te.splice(e,1),(e=m[r].indexOf(this))>=0&&m[r].splice(e,1),v.prototype.destroy.call(this)},P=function(e){var t=e;Object.defineProperties(this,{original:{enumerable:!0,configurable:!0,get:function(){return t.source}},id:{enumerable:!0,configurable:!0,get:function(){return t.id}},width:{enumerable:!0,configurable:!0,get:function(){return t.width}},height:{enumerable:!0,configurable:!0,get:function(){return t.height}}}),this.render=function(){t.render()},this.update=function(){t.setDirty()},this.readPixels=function(e,i,r,n,s){return t.readPixels(e,i,r,n,s)},this.on=function(e,i){t.on(e,i)},this.off=function(e,i){t.off(e,i)},this.destroy=function(){var e,i;for(e in t.destroy(),this)this.hasOwnProperty(e)&&"isDestroyed"!==e&&"id"!==e&&((i=Object.getOwnPropertyDescriptor(this,e)).get||i.set||"function"!==typeof this[e]?delete this[e]:this[e]=w)},this.isDestroyed=function(){return t.isDestroyed},this.isReady=function(){return t.ready}},(b=function(e,t,i){var n,s,o=i||{},a=void 0===o.flip||o.flip,u=o.width,h=o.height,f=!1,c=this,d=!1;function p(e,t,i,r){var n=l[e];if(n.definition){if(!(n=n.definition.call(c,t,i,r)))return null;n=L(L({},l[e]),n)}return n}function m(e){return c.source===e}if(v.call(this),(e&&"string"!==typeof e||!t&&0!==t)&&(i&&"object"===typeof i||(i=t),t=e),"string"===typeof t&&isNaN(t)&&(t=I(t,["canvas","img","video"])),"string"===typeof e&&l[e]&&(s=p(e,t,i,!0))&&(this.hook=e,d=!0,f=s.deferTexture,this.plugin=s,this.compare=s.compare,this.checkDirty=s.checkDirty,s.source&&(t=s.source)),!s&&M(t))"CANVAS"===t.tagName?(this.width=t.width,this.height=t.height,this.render=this.renderImageCanvas,d=!0,this.hook="canvas",this.compare=m):"IMG"===t.tagName&&(this.width=t.naturalWidth||1,this.height=t.naturalHeight||1,t.complete&&t.naturalWidth||(f=!0),t.addEventListener("load",(function(){c.isDestroyed||(c.width===t.naturalWidth&&c.height===t.naturalHeight||(c.width=t.naturalWidth,c.height=t.naturalHeight,c.resize()),c.setDirty(),c.setReady())}),!0),this.render=this.renderImageCanvas,d=!0,this.hook="image",this.compare=m);else if(!s&&M(t,"WebGLTexture")){if(r&&!r.isTexture(t))throw new Error("Not a valid WebGL texture.");isNaN(u)?isNaN(h)||(u=h):isNaN(h)&&(h=u),this.width=u,this.height=h,void 0===o.flip&&(a=!1),d=!0,this.texture=t,this.initialized=!0,this.hook="texture",this.compare=m,this.render=function(){}}if(!d&&!s)for(n in l)if(l.hasOwnProperty(n)&&l[n]&&(s=p(n,t,i,!1))){this.hook=n,d=!0,f=s.deferTexture,this.plugin=s,this.compare=s.compare,this.checkDirty=s.checkDirty,s.source&&(t=s.source);break}if(!d)throw new Error("Unknown source type");this.source=t,void 0===this.flip&&(this.flip=a),this.targets=[],f||c.setReady(),this.pub=new P(this),V.push(this),H[this.id]=this,$.push(this),g[this.hook].push(this),$.length&&!z&&pe()}).prototype=Object.create(v.prototype),b.prototype.constructor=b,b.prototype.initialize=function(){var e;r&&!this.texture&&this.ready&&(e=r.createTexture(),r.bindTexture(r.TEXTURE_2D,e),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.bindTexture(r.TEXTURE_2D,null),this.texture=e,this.initialized=!0,this.allowRefresh=!0,this.setDirty())},b.prototype.initFrameBuffer=function(e){r&&(this.frameBuffer=new q(r,this.width,this.height,{texture:this.texture,useFloat:e}))},b.prototype.addTarget=function(e){var t;for(t=0;t<this.targets.length;t++)if(this.targets[t]===e)return;this.targets.push(e)},b.prototype.removeTarget=function(e){var t=this.targets&&this.targets.indexOf(e);t>=0&&this.targets.splice(t,1)},b.prototype.resize=function(){var e,t;if(this.uniforms.resolution[0]=this.width,this.uniforms.resolution[1]=this.height,this.framebuffer&&this.framebuffer.resize(this.width,this.height),this.emit("resize"),this.setDirty(),this.targets)for(e=0;e<this.targets.length;e++)(t=this.targets[e]).resize(),t.setTransformDirty&&t.setTransformDirty()},b.prototype.setReady=function(){var e;if(!this.ready&&(this.ready=!0,this.resize(),this.initialize(),this.emit("ready"),this.targets))for(e=0;e<this.targets.length;e++)this.targets[e].setReady()},b.prototype.render=function(){var e=this.source;r&&(e||0===e)&&this.ready&&(this.initialized||this.initialize(),this.allowRefresh&&this.plugin&&this.plugin.render&&(this.dirty||this.checkDirty&&this.checkDirty())&&this.plugin.render.call(this,r,me,h,p)&&(this.dirty=!1,this.emit("render")))},b.prototype.renderImageCanvas=function(){var t=this.source;if(r&&t&&this.ready&&(this.initialized||this.initialize(),this.allowRefresh&&this.dirty)){r.bindTexture(r.TEXTURE_2D,this.texture),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,this.flip),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);try{return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t),this.dirty=!1,this.emit("render"),!0}catch(i){i.code===e.DOMException.SECURITY_ERR&&(this.allowRefresh=!1,K.logger.error("Unable to access cross-domain image"))}return!1}},b.prototype.destroy=function(){var e,t,i;for(this.plugin&&this.plugin.destroy&&this.plugin.destroy.call(this),r&&this.texture&&r.deleteTexture(this.texture);this.targets.length;)(i=this.targets.pop())&&i.removeSource&&i.removeSource(this);for(t in(e=$.indexOf(this))>=0&&$.splice(e,1),(e=g[this.hook].indexOf(this))>=0&&g[this.hook].splice(e,1),this)this.hasOwnProperty(t)&&"id"!==t&&delete this[t];v.prototype.destroy.call(this)},O=function(e){var t=e;Object.defineProperties(this,{source:{enumerable:!0,configurable:!0,get:function(){if(t.source)return t.source.pub},set:function(e){t.setSource(e)}},original:{enumerable:!0,configurable:!0,get:function(){return t.target}},width:{enumerable:!0,configurable:!0,get:function(){return t.width},set:function(e){!isNaN(e)&&e>0&&t.width!==e&&(t.width=e,t.resize(),t.setTransformDirty())}},height:{enumerable:!0,configurable:!0,get:function(){return t.height},set:function(e){!isNaN(e)&&e>0&&t.height!==e&&(t.height=e,t.resize(),t.setTransformDirty())}},id:{enumerable:!0,configurable:!0,get:function(){return t.id}}}),this.render=function(){t.render()},this.readPixels=function(e,i,r,n,s){return t.readPixels(e,i,r,n,s)},this.on=function(e,i){t.on(e,i)},this.off=function(e,i){t.off(e,i)},this.go=function(e){t.go(e)},this.stop=function(){t.stop()},this.getTexture=function(){return t.frameBuffer.texture},this.destroy=function(){var e,i;for(e in t.destroy(),this)this.hasOwnProperty(e)&&"isDestroyed"!==e&&"id"!==e&&((i=Object.getOwnPropertyDescriptor(this,e)).get||i.set||"function"!==typeof this[e]?delete this[e]:this[e]=w)},this.inputs=function(e){return{source:{type:"image"}}},this.isDestroyed=function(){return t.isDestroyed},this.isReady=function(){return t.ready}},((R=function(e,t,i){var n,u,f,c,l,m,y,g,E,b=this,T=!1;function _(e,t,i,n){var s=d[e];if(s.definition){if(!(s=s.definition.call(b,t,i,n)))return null;s=L(L({},d[e]),s),b.hook=E,T=!0,b.plugin=s,b.compare=s.compare,s.target&&(t=s.target),s.gl&&!b.gl&&(b.gl=s.gl,r||ce(s.gl)),b.gl===r&&(b.model=h,b.shader=p)}return s}if(v.call(this),(e&&"string"!==typeof e||!t&&0!==t)&&(i&&"object"===typeof i||(i=t),t=e),u=void 0===(n=i||{}).flip||n.flip,f=parseInt(n.width,10),c=parseInt(n.height,10),m=n.debugContext,"string"===typeof e&&d[e]&&_(e,t,n,!0),this.renderToTexture=n.renderToTexture,M(t,"WebGLFramebuffer"))if(y=t,M(n,"HTMLCanvasElement"))t=n;else if(M(n,"WebGLRenderingContext"))t=n.canvas;else if(M(n.canvas,"HTMLCanvasElement"))t=n.canvas;else{if(!M(n.context,"WebGLRenderingContext"))throw new Error("Must provide a canvas with WebGLFramebuffer target");t=n.context.canvas}if(M(t,"HTMLCanvasElement")){if(f=t.width,c=t.height,(!r||r.canvas!==t&&n.allowSecondaryWebGL)&&(!0,l=j(t,{alpha:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!0,stencil:!0,debugContext:m})),l)r&&r!==l?(this.gl=l,this.frameBuffer={frameBuffer:y||null},this.shader=new Z(this.gl,o,a),this.model=fe.call(this,this.gl),this.pixels=null,this.texture=this.gl.createTexture(),this.gl.bindTexture(r.TEXTURE_2D,this.texture),this.gl.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),this.gl.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),this.gl.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),this.gl.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),this.render=this.renderSecondaryWebGL):(s||(s=this),r||ce(l),this.render=this.renderWebGL,n.renderToTexture?r&&(this.frameBuffer=new q(r,f,c,!1)):this.frameBuffer={frameBuffer:y||null});else{if(!n.allowSecondaryWebGL&&r&&r.canvas!==t)throw new Error("Only one WebGL target canvas allowed. Set allowSecondaryWebGL option to create secondary context.");this.render=w,K.logger.log("Unable to create WebGL context.")}T=!0}if(!T)for(E in d)if(d.hasOwnProperty(E)&&d[E]&&_(E,t,n,!1))break;if(!T)throw new Error("Unknown target type");x&&((g=x.get(t))?K.logger.warn("Target already in use by another instance",t,Object.keys(g).map((function(e){return g[e]}))):(g={},x.set(t,g)),g[X.id]=X),this.target=t,this.transform=null,this.transformDirty=!0,this.flip=u,f&&(this.width=f),c&&(this.height=c),this.uniforms.resolution[0]=this.width,this.uniforms.resolution[1]=this.height,void 0!==n.auto?this.auto=n.auto:this.auto=ae,this.frames=0,this.pub=new O(this),V.push(this),H[this.id]=this,Q.push(this)}).prototype=Object.create(v.prototype)).constructor=R,R.prototype.setSource=function(e){var t;(t=ye(e))!==this.source&&(this.source&&this.source.removeTarget(this),this.source=t,t.addTarget(this),t&&(this.resize(),t.ready?this.setReady():this.setUnready()),this.setDirty())},R.prototype.setDirty=function(){this.dirty=!0,this.auto&&!z&&(z=C(pe))},R.prototype.resize=function(){M(this.target,"HTMLCanvasElement")?this.width===this.target.width&&this.height===this.target.height||(this.target.width=this.width,this.target.height=this.height,this.uniforms.resolution[0]=this.width,this.uniforms.resolution[1]=this.height,this.emit("resize"),this.setTransformDirty()):this.plugin&&this.plugin.resize&&this.plugin.resize.call(this),!this.source||this.source.width===this.width&&this.source.height===this.height||this.transform||(this.transform=new Float32Array(16))},R.prototype.setTransformDirty=function(){this.transformDirty=!0,this.setDirty()},R.prototype.go=function(){this.auto=!0,this.setDirty()},R.prototype.stop=function(){this.auto=!1},R.prototype.render=function(){r&&this.plugin&&this.plugin.render&&this.plugin.render.call(this,me,p,h)},R.prototype.renderWebGL=function(){var e,t,i;if(this.resize(),r&&this.dirty&&this.ready){if(!this.source)return;this.source.render(),this.uniforms.source=this.source.texture,this.source.width===this.width&&this.source.height===this.height?this.uniforms.transform=this.source.cumulativeMatrix||n:this.transformDirty&&(e=this.transform,B.copy(e,this.source.cumulativeMatrix||n),t=this.source.width/this.width,i=this.source.height/this.height,e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=i,e[5]*=i,e[6]*=i,e[7]*=i,this.uniforms.transform=e,this.transformDirty=!1),me(p,h,this.uniforms,this.frameBuffer.frameBuffer,this,A),this.emit("render"),this.dirty=!1}},R.prototype.renderSecondaryWebGL=function(){var e,t,i,r,s;this.dirty&&this.ready&&this.source&&(this.emit("render"),this.source.render(!0),e=this.source.width,t=this.source.height,this.pixels&&this.pixels.length===e*t*4||(this.pixels=new Uint8Array(e*t*4)),this.source.readPixels(0,0,e,t,this.pixels),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e,t,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.pixels),e===this.width&&t===this.height?this.uniforms.transform=n:this.transformDirty&&(i=this.transform,B.copy(i,n),r=this.source.width/this.width,s=this.source.height/this.height,i[0]*=r,i[1]*=r,i[2]*=r,i[3]*=r,i[4]*=s,i[5]*=s,i[6]*=s,i[7]*=s,this.uniforms.transform=i,this.transformDirty=!1),this.uniforms.source=this.texture,me(this.shader,this.model,this.uniforms,null,this,A),this.dirty=!1)},R.prototype.removeSource=function(e){this.source!==e&&this.source!==e.pub||(this.source=null)},R.prototype.destroy=function(){var e,t;this.source&&this.source.removeTarget&&this.source.removeTarget(this),x&&(delete(t=x.get(this.target))[X.id],Object.keys(t).length||x.delete(this.target)),this.plugin&&this.plugin.destroy&&this.plugin.destroy.call(this),delete this.source,delete this.target,delete this.pub,delete this.uniforms,delete this.pixels,delete this.auto,(e=Q.indexOf(this))>=0&&Q.splice(e,1),v.prototype.destroy.call(this),this===s&&(i&&i.removeEventListener("webglcontextrestored",le,!1),de(),s=null)},F=function(e){var t,i=e,r=this;function n(e,t){Object.defineProperty(r,e,{configurable:!0,enumerable:!0,get:function(){return t.get.call(i)},set:function(r){!function(e,t,r){var n,s,o;n=i.inputElements[e],"string"===typeof r&&isNaN(r)&&("enum"===t.type?t.options.hasOwnProperty(r)||(r=I(r,["select"])):"number"===t.type||"boolean"===t.type?r=I(r,["input","select"]):"image"===t.type&&(r=I(r,["canvas","img","video"]))),M(r,"HTMLInputElement")||M(r,"HTMLSelectElement")?(s=r.value,n&&n.element!==r&&(n.element.removeEventListener("change",n.listener,!0),n.element.removeEventListener("input",n.listener,!0),delete i.inputElements[e],n=null),n||(n={element:r,listener:(o=r,function(){var t,n;t="checkbox"===r.type?r.checked:o.value,n=i.setInput(e,t),"color"===r.type&&(n=G(n)),n!==t&&(o.value=n)})},i.inputElements[e]=n,"range"===r.type?(r.addEventListener("input",n.listener,!0),r.addEventListener("change",n.listener,!0)):r.addEventListener("change",n.listener,!0)),n&&"checkbox"===r.type&&(s=r.checked)):(n&&(n.element.removeEventListener("change",n.listener,!0),n.element.removeEventListener("input",n.listener,!0),delete i.inputElements[e]),s=r),i.setInput(e,s)}(e,t,r)}})}function s(e){return function(){e.apply(i,arguments)&&i.setTransformDirty()}}for(t in Object.defineProperties(this,{transform:{enumerable:!0,configurable:!0,get:function(){return i.hook}},title:{enumerable:!0,configurable:!0,get:function(){return i.plugin.title||i.hook}},width:{enumerable:!0,configurable:!0,get:function(){return i.width}},height:{enumerable:!0,configurable:!0,get:function(){return i.height}},id:{enumerable:!0,configurable:!0,get:function(){return i.id}},source:{enumerable:!0,configurable:!0,get:function(){return i.source&&i.source.pub},set:function(e){i.setSource(e)}}}),i.methods)i.methods.hasOwnProperty(t)&&(this[t]=s(i.methods[t]));for(t in i.inputs)i.inputs.hasOwnProperty(t)&&n(t,i.inputs[t]);this.update=function(){i.setDirty()},this.inputs=function(e){var t,r,n,s;if(n=i.plugin.inputs,e)return!(r=n[e])||r.method?null:(t={type:r.type,defaultValue:r.defaultValue,title:r.title||e},"number"===r.type?(t.min=r.min,t.max=r.max,t.step=r.step,t.mod=r.mod):"enum"===r.type?t.options=L({},r.options):"vector"===r.type&&(t.dimensions=r.dimensions),r.description&&(t.description=r.description),t);for(s in t={},n)n.hasOwnProperty(s)&&!n[s].method&&(t[s]=this.inputs(s));return t},this.alias=function(e,t){return i.alias(e,t),this},this.on=function(e,t){i.on(e,t)},this.off=function(e,t){i.off(e,t)},this.destroy=function(){var e,t;for(e in i.destroy(),this)this.hasOwnProperty(e)&&"isDestroyed"!==e&&"id"!==e&&((t=Object.getOwnPropertyDescriptor(this,e)).get||t.set||"function"!==typeof this[e]?delete this[e]:this[e]=w)},this.isDestroyed=function(){return i.isDestroyed},this.isReady=function(){return i.ready}},(_=function(e,t){var i,r,n,s,o;for(i in this.matrix=new Float32Array(16),this.cumulativeMatrix=new Float32Array(16),this.ready=!1,this.width=1,this.height=1,this.seriously=X,this.transformRef=c[e],this.hook=e,this.id=J,J++,this.options=t,this.sources=null,this.targets=[],this.inputElements={},this.inputs={},this.methods={},this.listeners={},this.texture=null,this.frameBuffer=null,this.uniforms=null,this.dirty=!0,this.transformDirty=!0,this.renderDirty=!1,this.isDestroyed=!1,this.transformed=!1,this.plugin=L({},this.transformRef),this.transformRef.definition&&L(this.plugin,this.transformRef.definition.call(this,t)),this.plugin.inputs)this.plugin.inputs.hasOwnProperty(i)&&((r=this.plugin.inputs[i]).method&&"function"===typeof r.method?this.methods[i]=r.method:"function"===typeof r.set&&"function"===typeof r.get&&(this.inputs[i]=r));for(i in Y(this.plugin),o=se[e],this.plugin.inputs)this.plugin.inputs.hasOwnProperty(i)&&"function"===typeof(r=this.plugin.inputs[i]).set&&"function"===typeof r.get&&"function"!==typeof r.method&&(n=r.get.call(this),s=void 0===r.defaultValue?n:r.defaultValue,s=r.validate.call(this,s,r,n),o&&void 0!==o[i]&&(s=r.validate.call(this,o[i],r,r.defaultValue,s),o[i]=s),s!==n&&r.set.call(this,s));V.push(this),H[this.id]=this,this.pub=new F(this),ee.push(this),y[e].push(this)}).prototype=Object.create(v.prototype),_.prototype.constructor=_,_.prototype.setDirty=function(){this.renderDirty=!0,v.prototype.setDirty.call(this)},_.prototype.setTransformDirty=function(){var e,t;for(this.transformDirty=!0,this.dirty=!0,this.renderDirty=!0,e=0;e<this.targets.length;e++)(t=this.targets[e]).setTransformDirty?t.setTransformDirty():t.setDirty()},_.prototype.resize=function(){var e;for(v.prototype.resize.call(this),this.plugin.resize&&this.plugin.resize.call(this),e=0;e<this.targets.length;e++)this.targets[e].resize();this.setTransformDirty()},_.prototype.setSource=function(e){var t;if((t=ye(e))!==this.source){if(ge(t,this))throw new Error("Attempt to make cyclical connection.");this.source&&this.source.removeTarget(this),this.source=t,t.addTarget(this),t&&t.ready?this.setReady():this.setUnready(),this.resize()}},_.prototype.addTarget=function(e){var t;for(t=0;t<this.targets.length;t++)if(this.targets[t]===e)return;this.targets.push(e)},_.prototype.removeTarget=function(e){var t=this.targets&&this.targets.indexOf(e);t>=0&&this.targets.splice(t,1),this.targets&&this.targets.length&&this.resize()},_.prototype.setInput=function(e,t){var i,r,n;if(this.plugin.inputs.hasOwnProperty(e))return i=this.plugin.inputs[e],r=se[this.hook]&&void 0!==se[this.hook][e]?se[this.hook][e]:i.defaultValue,n=i.get.call(this),void 0===r&&(r=n),t=i.validate.call(this,t,i,r,n),i.set.call(this,t)&&this.setTransformDirty(),i.get.call(this)},_.prototype.alias=function(e,t){var i,r,n=this;if(U.indexOf(t)>=0)throw new Error("'"+t+"' is a reserved name and cannot be used as an alias.");return this.plugin.inputs.hasOwnProperty(e)&&(t||(t=e),X.removeAlias(t),(i=this.inputs[e])?(r=n.inputs[e],Object.defineProperty(X,t,{configurable:!0,enumerable:!0,get:function(){return r.get.call(n)},set:function(e){r.set.call(n,e)&&n.setTransformDirty()}})):(i=this.methods[e])&&(r=i,X[t]=function(){r.apply(n,arguments)&&n.setTransformDirty()}),i&&(ie[t]={node:this,input:e})),this},_.prototype.render=function(e){return this.source?(this.source.render(),this.transformDirty&&(this.transformed?this.source.cumulativeMatrix?B.multiply(this.cumulativeMatrix,this.matrix,this.source.cumulativeMatrix):B.copy(this.cumulativeMatrix,this.matrix):B.copy(this.cumulativeMatrix,this.source.cumulativeMatrix||n),this.transformDirty=!1),e&&r?(this.renderDirty&&(this.frameBuffer||(this.uniforms={resolution:[this.width,this.height]},this.frameBuffer=new q(r,this.width,this.height)),this.uniforms.source=this.source.texture,this.uniforms.transform=this.cumulativeMatrix||n,me(p,h,this.uniforms,this.frameBuffer.frameBuffer,this),this.renderDirty=!1),this.texture=this.frameBuffer.texture):this.source?this.texture=this.source.texture:this.texture=null,this.dirty=!1,this.texture):(this.transformDirty&&(B.copy(this.cumulativeMatrix,this.matrix),this.transformDirty=!1),this.texture=null,void(this.dirty=!1))},_.prototype.readPixels=function(e,t,i,n,s){var o=this.gl||r;if(!r)throw new Error("Cannot read pixels until a canvas is connected");if(this.render(!0),void 0===s)s=new Uint8Array(i*n*4);else if(!M(s,"Uint8Array"))throw new Error("Incompatible array type");return o.bindFramebuffer(r.FRAMEBUFFER,this.frameBuffer.frameBuffer),o.readPixels(e,t,i,n,r.RGBA,r.UNSIGNED_BYTE,s),s},_.prototype.destroy=function(){var e,t,i,r=this.hook;for(e in this.plugin.destroy&&"function"===typeof this.plugin.destroy&&this.plugin.destroy.call(this),delete this.effect,this.frameBuffer&&(this.frameBuffer.destroy(),delete this.frameBuffer,delete this.texture),this.inputElements)this.inputElements.hasOwnProperty(e)&&((i=this.inputElements[e]).element.removeEventListener("change",i.listener,!0),i.element.removeEventListener("input",i.listener,!0));for(this.source&&this.source.removeTarget(this);this.targets.length;)(i=this.targets.pop())&&i.removeSource&&i.removeSource(this);for(t in this)this.hasOwnProperty(t)&&"id"!==t&&delete this[t];for(t in ie)ie.hasOwnProperty(t)&&(i=ie[t]).node===this&&X.removeAlias(t);(e=ee.indexOf(this))>=0&&ee.splice(e,1),(e=y[r].indexOf(this))>=0&&y[r].splice(e,1),v.prototype.destroy.call(this)},_.prototype.setReady=v.prototype.setReady,_.prototype.setUnready=v.prototype.setUnready,_.prototype.on=v.prototype.on,_.prototype.off=v.prototype.off,_.prototype.emit=v.prototype.emit,(t=M(t,"HTMLCanvasElement")?{canvas:t}:t||{}).canvas,this.effect=function(e,t){if(!f[e])throw new Error("Unknown effect: "+e);return new T(e,t).pub},this.source=function(e,t,i){return ye(e,t,i).pub},this.transform=function(e,i){if("string"!==typeof e&&(i=e,e=!1),e){if(!c[e])throw new Error("Unknown transform: "+e)}else if(e=t&&t.defaultTransform||"2d",!c[e])throw new Error("No transform specified");return new _(e,i).pub},this.target=function(e,t,i){var r,n,s;for(e&&"string"===typeof e&&!d[e]&&(n=u.querySelector(e)),("string"!==typeof e||!t&&0!==t||n)&&(i&&"object"===typeof i||(i=t),t=n||e,e=null),"string"===typeof t&&isNaN(t)&&(t=u.querySelector(t)),s=0;s<Q.length;s++)if(r=Q[s],(!e||e===r.hook)&&(r.target===t||r.compare&&r.compare(t,i)))return r.pub;return(r=new R(e,t,i)).pub},this.aliases=function(){return Object.keys(ie)},this.removeAlias=function(e){ie[e]&&(delete this[e],delete ie[e])},this.defaults=function(e,t){var i;if(e)if("object"!==typeof e)null===t?delete se[e]:"object"===typeof t&&(se[e]=L({},t));else for(i in e)e.hasOwnProperty(i)&&this.defaults(i,e[i]);else if(null===e)for(i in se)se.hasOwnProperty(i)&&delete se[i]},this.go=function(e,t){var i;for("function"===typeof e&&re.indexOf(e)<0&&re.push(e),"function"===typeof t&&ne.indexOf(t)<0&&ne.push(t),ae=!0,i=0;i<Q.length;i++)Q[i].go();z||!re.length&&!ne.length||pe()},this.stop=function(){re.length=0,ne.length=0,S(z),z=0},this.render=function(){var e;for(e=0;e<Q.length;e++)Q[e].render(t)},this.destroy=function(){for(var e,t;V.length;)V[0].pub.destroy();for(e in this)this.hasOwnProperty(e)&&"isDestroyed"!==e&&"id"!==e&&((t=Object.getOwnPropertyDescriptor(this,e)).get||t.set||"function"!==typeof this[e]?delete this[e]:this[e]=w);X=null,$=[],Q=[],te=[],V=[],re.length=0,ne.length=0,S(z),z=0,ue=!0},this.isDestroyed=function(){return ue},this.incompatible=function(e){var t,i,r;if(r=K.incompatible(e))return r;if(!e){for(t in m)if(m.hasOwnProperty(t)&&m[t].length&&(i=f[t])&&"function"===typeof i.compatible&&!i.compatible.call(this))return"plugin-"+t;for(t in g)if(g.hasOwnProperty(t)&&g[t].length&&(i=l[t])&&"function"===typeof i.compatible&&!i.compatible.call(this))return"source-"+t}return!1},this.isNode=function(e){var t;return!(!e||!(t=H[e.id])||t.isDestroyed)},this.isSource=function(e){return this.isNode(e)&&e instanceof P},this.isEffect=function(e){return this.isNode(e)&&e instanceof D},this.isTransform=function(e){return this.isNode(e)&&e instanceof F},this.isTarget=function(e){return this.isNode(e)&&e instanceof O},Object.defineProperties(this,{id:{enumerable:!0,configurable:!0,get:function(){return k}}}),this.defaults(t.defaults)}e.addEventListener("message",(function(t){t.source===e&&"seriously-timeout-message"===t.data&&(t.stopPropagation(),p.length>0&&p.shift()())}),!0),q.prototype.resize=function(e,t){var i=this.gl;this.width===e&&this.height===t||(this.width=e,this.height=t,i&&(i.bindTexture(i.TEXTURE_2D,this.texture),i.bindFramebuffer(i.FRAMEBUFFER,this.frameBuffer),i.bindRenderbuffer(i.RENDERBUFFER,this.renderBuffer),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.UNSIGNED_BYTE,null),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,e,t),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.texture,0),i.bindTexture(i.TEXTURE_2D,null),i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,null)))},q.prototype.destroy=function(){var e=this.gl;e&&(e.deleteFramebuffer(this.frameBuffer),e.deleteRenderbuffer(this.renderBuffer),this.ownTexture&&e.deleteTexture(this.texture)),delete this.frameBuffer,delete this.renderBuffer,delete this.texture,delete this.gl},Z.prototype.use=function(){this.gl.useProgram(this.program)},K.incompatible=function(t){var i,n,s;if(void 0===r&&((i=u.createElement("canvas"))&&i.getContext?e.WebGLRenderingContext?(n=V())||(r="context"):r="webgl":r="canvas"),r)return r;if(t){if((s=f[t])&&"function"===typeof s.compatible&&!s.compatible(n))return"plugin-"+t;if((s=l[t])&&"function"===typeof s.compatible&&!s.compatible(n))return"source-"+t}return!1},K.plugin=function(e,t,i){var r;if(f[e])K.logger.warn("Effect ["+e+"] already loaded");else if(void 0===i&&"object"===typeof t&&(i=t),i)return r=L({},i),"function"===typeof t&&(r.definition=t),r.reserved=F,r.inputs&&Y(r),r.title||(r.title=e),f[e]=r,m[e]=[],r},K.removePlugin=function(e){var t;if(!e)return this;if(!f[e])return this;if(t=m[e]){for(;t.length;)t.shift().destroy();delete m[e]}return delete f[e],this},K.source=function(e,t,i){var r;if(l[e])K.logger.warn("Source ["+e+"] already loaded");else if(void 0===i&&"object"===typeof t&&(i=t),i||t)return r=L({},i),"function"===typeof t&&(r.definition=t),r.title||(r.title=e),l[e]=r,g[e]=[],r},K.removeSource=function(e){var t;if(!e)return this;if(!l[e])return this;if(t=g[e]){for(;t.length;)t.shift().destroy();delete g[e]}return delete l[e],this},K.transform=function(e,t,i){var r;if(c[e])K.logger.warn("Transform ["+e+"] already loaded");else if(void 0===i&&"object"===typeof t&&(i=t),i||t)return r=L({},i),"function"===typeof t&&(r.definition=t),r.reserved=O,r.inputs&&Y(r),r.title||(r.title=e),c[e]=r,y[e]=[],r},K.removeTransform=function(e){var t;if(!e)return this;if(!c[e])return this;if(t=y[e]){for(;t.length;)t.shift().destroy();delete y[e]}return delete c[e],this},K.target=function(e,t,i){var r;if(d[e])K.logger.warn("Target ["+e+"] already loaded");else if(void 0===i&&"object"===typeof t&&(i=t),i||t)return r=L({},i),"function"===typeof t&&(r.definition=t),r.title||(r.title=e),d[e]=r,v[e]=[],r},K.removeTarget=function(e){var t;if(!e)return this;if(!d[e])return this;if(t=v[e]){for(;t.length;)t.shift().destroy();delete v[e]}return delete d[e],this},K.inputValidators={color:function(e,t,r,n){var s,o,a,h;if(o=n||[],"string"===typeof e){if((a=T.exec(e))&&a.length){if(a.length<3)return o[0]=o[1]=o[2]=o[3]=0,o;for(o[3]=1,h=0;h<3;h++)o[h]=parseFloat(a[h+2])/255;return isNaN(a[6])||(o[3]=parseFloat(a[6])),"hsl"===a[1].toLowerCase()?k(o[0],o[1],o[2],o[3],o):o}if((a=_.exec(e))&&a.length)return 3===(s=a[1]).length?(o[0]=parseInt(s[0],16)/15,o[1]=parseInt(s[1],16)/15,o[2]=parseInt(s[2],16)/15,o[3]=1):4===s.length?(o[0]=parseInt(s[0],16)/15,o[1]=parseInt(s[1],16)/15,o[2]=parseInt(s[2],16)/15,o[3]=parseInt(s[3],16)/15):6===s.length?(o[0]=parseInt(s.substr(0,2),16)/255,o[1]=parseInt(s.substr(2,2),16)/255,o[2]=parseInt(s.substr(4,2),16)/255,o[3]=1):8===s.length?(o[0]=parseInt(s.substr(0,2),16)/255,o[1]=parseInt(s.substr(2,2),16)/255,o[2]=parseInt(s.substr(4,2),16)/255,o[3]=parseInt(s.substr(6,2),16)/255):o[0]=o[1]=o[2]=o[3]=0,o;if(a=b[e.toLowerCase()]){for(h=0;h<4;h++)o[h]=a[h];return o}return i||(i=u.createElement("canvas").getContext("2d")),i.fillStyle=e,(s=i.fillStyle)&&"#000000"!==s?K.inputValidators.color(s,t,r,n):(o[0]=o[1]=o[2]=o[3]=0,o)}if(X(e)){if((o=e).length<3)return o[0]=o[1]=o[2]=o[3]=0,o;for(h=0;h<3;h++)if(isNaN(o[h]))return o[0]=o[1]=o[2]=o[3]=0,o;return o.length<4&&o.push(1),o}if("number"===typeof e)return o[0]=o[1]=o[2]=e,o[3]=1,o;if("object"===typeof e){for(h=0;h<4;h++)null===e[s=D[h]]||isNaN(e[s])?o[h]=3===h?1:0:o[h]=e[s];return o}return o[0]=o[1]=o[2]=o[3]=0,o},number:function(e,t,i){return e=parseFloat(e),isNaN(e)?i||0:(t.mod&&(e-=t.mod*Math.floor(e/t.mod)),e<t.min?t.min:e>t.max?t.max:t.step?Math.round(e/t.step)*t.step:e)},enum:function(e,t,i){var r=t.options||[];return"string"===typeof e?e=e.toLowerCase():"number"===typeof e?e=e.toString():e||(e=""),r.hasOwnProperty(e)?e:i||""},vector:function(e,t,i,r){var n,s,o,a=t.dimensions||4;if(n=r||[],X(e)){for(s=0;s<a;s++)n[s]=e[s]||0;return n}if("object"===typeof e){for(s=0;s<a;s++)void 0===e[o=R[s]]&&(o=D[s]),n[s]=e[o]||0;return n}for(e=parseFloat(e)||0,s=0;s<a;s++)n[s]=e;return n},boolean:function(e){return!!e&&(!e||!e.toLowerCase||"false"!==e.toLowerCase())},string:function(e){return"string"===typeof e?e:0===e||e?e.toString?e.toString():String(e):""}},K.prototype.effects=K.effects=function(){var e,t,i,r,n,s={};for(e in f)if(f.hasOwnProperty(e)){for(n in i={title:(t=f[e]).title||e,description:t.description||"",inputs:{}},t.inputs)t.inputs.hasOwnProperty(n)&&(r=t.inputs[n],i.inputs[n]={type:r.type,defaultValue:r.defaultValue,step:r.step,min:r.min,max:r.max,mod:r.mod,minCount:r.minCount,maxCount:r.maxCount,dimensions:r.dimensions,title:r.title||n,description:r.description||"",options:r.options||[]});s[e]=i}return s},e.Float32Array&&(n=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]));e.Seriously&&"object"===typeof e.Seriously&&function(){var t;for(t in e.Seriously)e.Seriously.hasOwnProperty(t)&&"plugin"!==t&&"object"===typeof e.Seriously[t]&&K.plugin(t,e.Seriously[t])}();return K.logger={log:z("log"),info:z("info"),warn:z("warn"),error:z("error")},K.util={mat4:B,checkSource:H,hslToRgb:k,colors:b,setTimeoutZero:W,ShaderProgram:Z,FrameBuffer:q,requestAnimationFrame:C,shader:{makeNoise:"float makeNoise(float u, float v, float timer) {\n\tfloat x = u * v * mod(timer * 1000.0, 100.0);\n\tx = mod(x, 13.0) * mod(x, 127.0);\n\tfloat dx = mod(x, 0.01);\n\treturn clamp(0.1 + dx * 100.0, 0.0, 1.0);\n}\n",random:"#ifndef RANDOM\n#define RANDOM\nfloat random(vec2 n) {\n\treturn 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453);\n}\n#endif\n"}},K.source("video",(function(t,i,r){var n,o,a=this,h=!1,f=!1,c=!1,l=0;function d(){t.removeEventListener("loadedmetadata",d,!0),h||(t.videoWidth?(a.width===t.videoWidth&&a.height===t.videoHeight||(a.width=t.videoWidth,a.height=t.videoHeight,a.resize()),f&&a.setReady()):(f=!0,setTimeout(d,50)))}function p(){c=!0}function m(){c=!1,a.setDirty()}if(M(t,"HTMLVideoElement"))return t.readyState?d():(f=!0,t.addEventListener("loadedmetadata",d,!0)),t.addEventListener("seeking",p,!1),t.addEventListener("seeked",m,!1),{deferTexture:f,source:t,render:function i(r){var h;if(l=t.currentTime,!t.videoHeight||!t.videoWidth)return!1;s?(o||(o=u.createElement("canvas").getContext("2d"),(n=o.canvas).width=a.width,n.height=a.height),h=n,o.drawImage(t,0,0,a.width,a.height)):h=t,r.bindTexture(r.TEXTURE_2D,a.texture),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,a.flip),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,h),void 0===s){if(r.getError()===r.INVALID_VALUE)return s=!0,i(r);s=!1}return!0}catch(f){f.code===e.DOMException.SECURITY_ERR?(a.allowRefresh=!1,K.logger.error("Unable to access cross-domain image")):K.logger.error("Error rendering video source",f)}return!1},checkDirty:function(){return!c&&t.currentTime!==l},compare:function(e){return a.source===e},destroy:function(){h=!0,t.removeEventListener("seeking",p,!1),t.removeEventListener("seeked",m,!1),t.removeEventListener("loadedmetadata",d,!0)}}}),{title:"Video"}),K.transform("2d",(function(e){var t=this,i=!(e&&e.radians),r=0,n=0,s=1,o=1,a=0,u=0,h=0,f=0,c=0;function l(){var e,l,d,p,m,y,g,v,x,E,w,b=t.matrix;function T(e,t){b[12]=b[0]*e+b[4]*t+b[12],b[13]=b[1]*e+b[5]*t+b[13],b[14]=b[2]*e+b[6]*t+b[14],b[15]=b[3]*e+b[7]*t+b[15]}a||u||h||f||c||1!==s||1!==o?(B.identity(b),T(a+r,u+n),f&&(b[4]=f/t.width),c&&(b[1]=c/t.height),h&&(p=b[0],m=b[1],y=b[2],g=b[3],v=b[4],x=b[5],E=b[6],w=b[7],e=-(i?h*Math.PI/180:h),l=Math.sin(e),d=Math.cos(e),b[0]=p*d+v*l,b[1]=m*d+x*l,b[2]=y*d+E*l,b[3]=g*d+w*l,b[4]=v*d-p*l,b[5]=x*d-m*l,b[6]=E*d-y*l,b[7]=w*d-g*l),1!==s&&(b[0]*=s,b[1]*=s,b[2]*=s,b[3]*=s),1!==o&&(b[4]*=o,b[5]*=o,b[6]*=o,b[7]*=o),T(-r,-n),t.transformed=!0):t.transformed=!1}return{inputs:{reset:{method:function(){return r=0,n=0,s=1,o=1,a=0,u=0,h=0,f=0,c=0,!!t.transformed&&(t.transformed=!1,!0)}},translate:{method:function(e,t){return isNaN(e)&&(e=a),isNaN(t)&&(t=u),(e!==a||t!==u)&&(a=e,u=t,l(),!0)},type:["number","number"]},translateX:{get:function(){return a},set:function(e){return e!==a&&(a=e,l(),!0)},type:"number"},translateY:{get:function(){return u},set:function(e){return e!==u&&(u=e,l(),!0)},type:"number"},rotation:{get:function(){return h},set:function(e){return e!==h&&(h=parseFloat(e),l(),!0)},type:"number"},center:{method:function(e,t){return isNaN(e)&&(e=r),isNaN(t)&&(t=n),(e!==r||t!==n)&&(r=e,n=t,l(),!0)},type:["number","number"]},centerX:{get:function(){return r},set:function(e){return e!==r&&(r=e,l(),!0)},type:"number"},centerY:{get:function(){return n},set:function(e){return e!==n&&(n=e,l(),!0)},type:"number"},skew:{method:function(e,t){return isNaN(e)&&(e=f),isNaN(t)&&(t=c),(e!==f||t!==c)&&(f=e,c=t,l(),!0)},type:["number","number"]},skewX:{get:function(){return f},set:function(e){return e!==f&&(f=e,l(),!0)},type:"number"},skewY:{get:function(){return c},set:function(e){return e!==c&&(c=e,l(),!0)},type:"number"},scale:{method:function(e,t){var i,r;if(i=isNaN(e)?s:e,isNaN(t)){if(isNaN(e))return!1;r=i}else r=t;return(i!==s||r!==o)&&(s=i,o=r,l(),!0)},type:["number","number"]},scaleX:{get:function(){return s},set:function(e){return e!==s&&(s=e,l(),!0)},type:"number"},scaleY:{get:function(){return o},set:function(e){return e!==o&&(o=e,l(),!0)},type:"number"}}}}),{title:"2D Transform",description:"Translate, Rotate, Scale, Skew"}),K.transform("flip",(function(){var e=this,t=!0;function i(){var i=e.matrix;t?(i[0]=-1,i[5]=1):(i[0]=1,i[5]=-1)}return B.identity(e.matrix),i(),e.transformDirty=!0,e.transformed=!0,{inputs:{direction:{get:function(){return t?"horizontal":"vertical"},set:function(e){var r;return(r="vertical"!==e)!==t&&(t=r,i(),!0)},type:"string"}}}}),{title:"Flip",description:"Flip Horizontal/Vertical"}),K.transform("reformat",(function(){var e,t,i=this,r="contain";function n(){var n,s,o,a,u=i.matrix,h=e||i.width,f=t||i.height,c=i.source,l=c&&c.width||1,d=c&&c.height||1;"distort"===r||h===l&&f===d?i.transformed=!1:(o=l/d,a=h/f,"none"===r?(n=l/h,s=d/f):"width"===r||"contain"===r&&a<=o?(n=1,s=a/o):"height"===r||"contain"===r&&a>o?(n=o/a,s=1):a>o?(n=1,s=a/o):(n=o/a,s=1),1!==n||1!==s?(B.identity(u),1!==n&&(u[0]*=n,u[1]*=n,u[2]*=n,u[3]*=n),1!==s&&(u[4]*=s,u[5]*=s,u[6]*=s,u[7]*=s),i.transformed=!0):i.transformed=!1)}function s(){return e||i.source&&i.source.width||1}function o(){return t||i.source&&i.source.height||1}return this.resize=function(){var e,t=s(),i=o();if(this.width!==t||this.height!==i)for(this.width=t,this.height=i,this.uniforms&&this.uniforms.resolution&&(this.uniforms.resolution[0]=t,this.uniforms.resolution[1]=i),this.frameBuffer&&this.frameBuffer.resize&&this.frameBuffer.resize(t,i),e=0;e<this.targets.length;e++)this.targets[e].resize();this.setTransformDirty(),n()},{inputs:{width:{get:s,set:function(t){return(t=Math.floor(t))===e||(e=t,this.resize()),!1},type:"number"},height:{get:o,set:function(e){return(e=Math.floor(e))===t||(t=e,this.resize()),!1},type:"number"},mode:{get:function(){return r},set:function(e){return e!==r&&(r=e,n(),!0)},type:"enum",options:["cover","contain","distort","width","height","none"]}}}}),{title:"Reformat",description:"Change output dimensions"}),o=["precision mediump float;","attribute vec4 position;","attribute vec2 texCoord;","uniform vec2 resolution;","uniform mat4 transform;","varying vec2 vTexCoord;","void main(void) {","\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);","\tscreenPosition = transform * screenPosition;","\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;","\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);","\tgl_Position.w = screenPosition.w;","\tvTexCoord = texCoord;","}\n"].join("\n"),a=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","void main(void) {","\t\tgl_FragColor = texture2D(source, vTexCoord);","}"].join("\n"),K.util.shader.noiseHelpers="#ifndef NOISE_HELPERS\n#define NOISE_HELPERS\nvec2 mod289(vec2 x) {\n\treturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 mod289(vec3 x) {\n\treturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec4 mod289(vec4 x) {\n\treturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 permute(vec3 x) {\n\treturn mod289(((x*34.0)+1.0)*x);\n}\nvec4 permute(vec4 x) {\n\treturn mod289(((x*34.0)+1.0)*x);\n}\nvec4 taylorInvSqrt(vec4 r) {\n\treturn 1.79284291400159 - 0.85373472095314 * r;\n}\nfloat taylorInvSqrt(float r) {\n\treturn 1.79284291400159 - 0.85373472095314 * r;\n}\n#endif\n",K.util.shader.snoise2d="#ifndef NOISE2D\n#define NOISE2D\nfloat snoise(vec2 v) {\n\tconst vec4 C = vec4(0.211324865405187, // (3.0-sqrt(3.0))/6.0\n\t\t0.366025403784439, // 0.5*(sqrt(3.0)-1.0)\n\t\t-0.577350269189626, // -1.0 + 2.0 * C.x\n\t\t0.024390243902439); // 1.0 / 41.0\n\tvec2 i = floor(v + dot(v, C.yy));\n\tvec2 x0 = v - i + dot(i, C.xx);\n\tvec2 i1;\n\t//i1.x = step(x0.y, x0.x); // x0.x > x0.y ? 1.0 : 0.0\n\t//i1.y = 1.0 - i1.x;\n\ti1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n\t// x0 = x0 - 0.0 + 0.0 * C.xx ;\n\t// x1 = x0 - i1 + 1.0 * C.xx ;\n\t// x2 = x0 - 1.0 + 2.0 * C.xx ;\n\tvec4 x12 = x0.xyxy + C.xxzz;\n\tx12.xy -= i1;\n\ti = mod289(i); // Avoid truncation effects in permutation\n\tvec3 p = permute(permute(i.y + vec3(0.0, i1.y, 1.0)) + i.x + vec3(0.0, i1.x, 1.0));\n\tvec3 m = max(0.5 - vec3(dot(x0, x0), dot(x12.xy, x12.xy), dot(x12.zw, x12.zw)), 0.0);\n\tm = m*m ;\n\tm = m*m ;\n\tvec3 x = 2.0 * fract(p * C.www) - 1.0;\n\tvec3 h = abs(x) - 0.5;\n\tvec3 ox = floor(x + 0.5);\n\tvec3 a0 = x - ox;\n\tm *= 1.79284291400159 - 0.85373472095314 * (a0*a0 + h*h);\n\tvec3 g;\n\tg.x = a0.x * x0.x + h.x * x0.y;\n\tg.yz = a0.yz * x12.xz + h.yz * x12.yw;\n\treturn 130.0 * dot(m, g);\n}\n#endif\n",K.util.shader.snoise3d="#ifndef NOISE3D\n#define NOISE3D\nfloat snoise(vec3 v) {\n\tconst vec2 C = vec2(1.0/6.0, 1.0/3.0) ;\n\tconst vec4 D = vec4(0.0, 0.5, 1.0, 2.0);\n\tvec3 i = floor(v + dot(v, C.yyy));\n\tvec3 x0 = v - i + dot(i, C.xxx) ;\n\tvec3 g = step(x0.yzx, x0.xyz);\n\tvec3 l = 1.0 - g;\n\tvec3 i1 = min(g.xyz, l.zxy);\n\tvec3 i2 = max(g.xyz, l.zxy);\n\t// x0 = x0 - 0.0 + 0.0 * C.xxx;\n\t// x1 = x0 - i1 + 1.0 * C.xxx;\n\t// x2 = x0 - i2 + 2.0 * C.xxx;\n\t// x3 = x0 - 1.0 + 3.0 * C.xxx;\n\tvec3 x1 = x0 - i1 + C.xxx;\n\tvec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n\tvec3 x3 = x0 - D.yyy; // -1.0+3.0*C.x = -0.5 = -D.y\n\ti = mod289(i);\n\tvec4 p = permute(permute(permute(\n\t\t\t\t\t\ti.z + vec4(0.0, i1.z, i2.z, 1.0))\n\t\t\t\t\t\t+ i.y + vec4(0.0, i1.y, i2.y, 1.0))\n\t\t\t\t\t\t+ i.x + vec4(0.0, i1.x, i2.x, 1.0));\n\tfloat n_ = 0.142857142857; // 1.0/7.0\n\tvec3 ns = n_ * D.wyz - D.xzx;\n\tvec4 j = p - 49.0 * floor(p * ns.z * ns.z); // mod(p, 7 * 7)\n\tvec4 x_ = floor(j * ns.z);\n\tvec4 y_ = floor(j - 7.0 * x_); // mod(j, N)\n\tvec4 x = x_ * ns.x + ns.yyyy;\n\tvec4 y = y_ * ns.x + ns.yyyy;\n\tvec4 h = 1.0 - abs(x) - abs(y);\n\tvec4 b0 = vec4(x.xy, y.xy);\n\tvec4 b1 = vec4(x.zw, y.zw);\n\t//vec4 s0 = vec4(lessThan(b0, 0.0)) * 2.0 - 1.0;\n\t//vec4 s1 = vec4(lessThan(b1, 0.0)) * 2.0 - 1.0;\n\tvec4 s0 = floor(b0) * 2.0 + 1.0;\n\tvec4 s1 = floor(b1) * 2.0 + 1.0;\n\tvec4 sh = -step(h, vec4(0.0));\n\tvec4 a0 = b0.xzyw + s0.xzyw * sh.xxyy ;\n\tvec4 a1 = b1.xzyw + s1.xzyw * sh.zzww ;\n\tvec3 p0 = vec3(a0.xy, h.x);\n\tvec3 p1 = vec3(a0.zw, h.y);\n\tvec3 p2 = vec3(a1.xy, h.z);\n\tvec3 p3 = vec3(a1.zw, h.w);\n\tvec4 norm = taylorInvSqrt(vec4(dot(p0, p0), dot(p1, p1), dot(p2, p2), dot(p3, p3)));\n\tp0 *= norm.x;\n\tp1 *= norm.y;\n\tp2 *= norm.z;\n\tp3 *= norm.w;\n\tvec4 m = max(0.6 - vec4(dot(x0, x0), dot(x1, x1), dot(x2, x2), dot(x3, x3)), 0.0);\n\tm = m * m;\n\treturn 42.0 * dot(m*m, vec4(dot(p0, x0), dot(p1, x1), dot(p2, x2), dot(p3, x3)));\n}\n#endif\n",K.util.shader.snoise4d="#ifndef NOISE4D\n#define NOISE4D\nvec4 grad4(float j, vec4 ip)\n\t{\n\tconst vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n\tvec4 p, s;\n\n\tp.xyz = floor(fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n\tp.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n\ts = vec4(lessThan(p, vec4(0.0)));\n\tp.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;\n\n\treturn p;\n\t}\n\n#define F4 0.309016994374947451\n\nfloat snoise(vec4 v)\n\t{\n\tconst vec4 C = vec4(0.138196601125011, // (5 - sqrt(5))/20 G4\n\t\t\t\t\t\t0.276393202250021, // 2 * G4\n\t\t\t\t\t\t0.414589803375032, // 3 * G4\n\t\t\t\t\t\t-0.447213595499958); // -1 + 4 * G4\n\n\tvec4 i = floor(v + dot(v, vec4(F4)));\n\tvec4 x0 = v - i + dot(i, C.xxxx);\n\n\n\tvec4 i0;\n\tvec3 isX = step(x0.yzw, x0.xxx);\n\tvec3 isYZ = step(x0.zww, x0.yyz);\n\ti0.x = isX.x + isX.y + isX.z;\n\ti0.yzw = 1.0 - isX;\n\ti0.y += isYZ.x + isYZ.y;\n\ti0.zw += 1.0 - isYZ.xy;\n\ti0.z += isYZ.z;\n\ti0.w += 1.0 - isYZ.z;\n\n\tvec4 i3 = clamp(i0, 0.0, 1.0);\n\tvec4 i2 = clamp(i0 - 1.0, 0.0, 1.0);\n\tvec4 i1 = clamp(i0 - 2.0, 0.0, 1.0);\n\n\tvec4 x1 = x0 - i1 + C.xxxx;\n\tvec4 x2 = x0 - i2 + C.yyyy;\n\tvec4 x3 = x0 - i3 + C.zzzz;\n\tvec4 x4 = x0 + C.wwww;\n\n\ti = mod289(i);\n\tfloat j0 = permute(permute(permute(permute(i.w) + i.z) + i.y) + i.x);\n\tvec4 j1 = permute(permute(permute(permute (\n\t\t\t\t\ti.w + vec4(i1.w, i2.w, i3.w, 1.0))\n\t\t\t\t\t+ i.z + vec4(i1.z, i2.z, i3.z, 1.0))\n\t\t\t\t\t+ i.y + vec4(i1.y, i2.y, i3.y, 1.0))\n\t\t\t\t\t+ i.x + vec4(i1.x, i2.x, i3.x, 1.0));\n\n\tvec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n\n\tvec4 p0 = grad4(j0, ip);\n\tvec4 p1 = grad4(j1.x, ip);\n\tvec4 p2 = grad4(j1.y, ip);\n\tvec4 p3 = grad4(j1.z, ip);\n\tvec4 p4 = grad4(j1.w, ip);\n\n\tvec4 norm = taylorInvSqrt(vec4(dot(p0, p0), dot(p1, p1), dot(p2, p2), dot(p3, p3)));\n\tp0 *= norm.x;\n\tp1 *= norm.y;\n\tp2 *= norm.z;\n\tp3 *= norm.w;\n\tp4 *= taylorInvSqrt(dot(p4, p4));\n\n\tvec3 m0 = max(0.6 - vec3(dot(x0, x0), dot(x1, x1), dot(x2, x2)), 0.0);\n\tvec2 m1 = max(0.6 - vec2(dot(x3, x3), dot(x4, x4)), 0.0);\n\tm0 = m0 * m0;\n\tm1 = m1 * m1;\n\treturn 49.0 * (dot(m0*m0, vec3(dot(p0, x0), dot(p1, x1), dot(p2, x2)))\n\t\t\t\t\t\t\t+ dot(m1*m1, vec2(dot(p3, x3), dot(p4, x4)))) ;\n}\n#endif\n",K}(n);return n.Seriously||(n.Seriously=e),e}.call(t,i,t,e))||(e.exports=r)}(window)},"z1Y/":function(e,t,i){var r,n,s;!function(o,a){"use strict";n=[i("onF7")],void 0===(s="function"===typeof(r=function(e){e.plugin("throttle",(function(){var e=0;return{draw:function(t,i,r,n,s){this.inputs.frameRate&&Date.now()-e>=1e3/this.inputs.frameRate&&(s(t,i,r,n),e=Date.now())},requires:function(t,i){return!!(i.frameRate&&Date.now()-e>=1e3/i.frameRate)}}}),{inPlace:!0,commonShader:!0,title:"Throttle",description:"Throttle frame rate",inputs:{source:{type:"image",uniform:"source"},frameRate:{type:"number",uniform:"opacity",defaultValue:15,min:0}}})})?r.apply(t,n):r)||(e.exports=s)}(window)}}]);
//# sourceMappingURL=scripts.dd5bf1e26b119e04a41e.chunk.js.map