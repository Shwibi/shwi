(this["webpackJsonpunacademy-live"]=this["webpackJsonpunacademy-live"]||[]).push([[15],{"18Ax":function(e,t,s){"use strict";s.r(t);var a=s("lSNA"),i=s.n(a),o=s("q1tI"),r=s.n(o),n=s("/MKj"),p=s("VEaK"),l=s("ri1g"),d=s("Ocil"),h=s("apID"),c=s("WlAH"),u=s("+UwG"),D=s("RYsq");function S(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function g(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?S(Object(s),!0).forEach((function(t){i()(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):S(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}const A=Object(p.e)(),y=A.getOrCreate("START_CLASS_SUCCESS_PROFILE"),R=A.getOrCreate("CLICK_TO_VIEW_PROFILE"),I=A.getOrCreate("EVENT_TIMELINE_PROFILE"),T=A.getOrCreate("SLIDE_RENDER_PROFILE"),v=new p.f;v.create("AFTER_META"),v.create("AFTER_DATA"),v.create("REPLAY_TOKEN"),v.then(()=>{I.end()});const E=-1,f=0;class M extends r.a.PureComponent{constructor(){super(),i()(this,"toggleSlideMode",(e,t)=>{this.props.setDarkMode(!1,{sendEvent:!1}),this.props.setLearnerSlideModeActive(e),this.props.setIsVideoPaused(t)}),i()(this,"getUsedSlides",()=>D.b.main.slides.length),i()(this,"changeCurrentSlide",e=>{this.props.setLearnerSlideModeActiveSlide(e)}),i()(this,"setAnnotationsStatus",e=>{this.props.setAnnotationsOff(e)}),i()(this,"hideChatForVideoRecordings",()=>{this.props.setIsChatHidden(!0)}),i()(this,"getSlideImage",e=>{const t=D.b.main.slides.getItem(e);if(t&&t.image)return t.image}),this.dataJson=[],this.state={playbackRate:1},window.replay=this,window.supportedMp4Formats=[],window.supportedWebmFormats=[],this.replayDetailsApiDone=!1,this.resetUnknownEventState(I,"eventTimelineProfile","profile is running before start up while it should not"),I.start(),T.reset(),this.analyticsDataForMilestone={}}componentDidMount(){this.props.shouldGetReplayToken&&!this.replayDetailsApiDone&&this.getReplayDetails(),this.props.isLocal&&this.props.videoId&&this.getReplayMeta(this.props.videoId),this.resetUnknownEventState(y,"startClassSuccessProfile","profile is running before start up while it should not"),y.start(),y.classHasFailure=E,this.resetUnknownEventState(R,"clickToViewProfile","profile is running before start up while it should not"),R.start();y.ttl(u.a.Replay).then(()=>{y.classHasFailure=f,u.f.sendData(u.c.CLASS_START_FAILURE,{ttlExpired:!0,refreshed:!0})}),u.f.sendData(u.c.METRIC_CALC_START,{isRecorded:!0,isWeb:!0})}componentDidUpdate(e){if(e.analyticsDebugData.id!==this.props.analyticsDebugData.id&&(this.props.analyticsDebugData.isSuccess?this.analyticsDataForMilestone[this.props.analyticsDebugData.milestone]=this.props.analyticsDebugData.data:this.manageAPIFailureEvents(this.props.analyticsDebugData)),this.props.isTokenApiDone&&!e.isTokenApiDone&&this.props.videoId&&this.getReplayMeta(this.props.videoId),!e.isReplayMetaFetched&&this.props.isReplayMetaFetched){this.props.getReplayData(this.props.videoId,this.dataJson,D.b.main);const e=I.peek().dts;u.f.sendData(u.c.META_DOWNLOADED,g({},this.analyticsDataForMilestone[u.d.DuringMetaFileResolve]||{}),{[u.e.Measure1]:e}),v.resolve("AFTER_META")}if(!e.isReplayDataProcessed&&this.props.isReplayDataProcessed){this.afterMeta(this.props.useGreenScreen),this.props.showSplashScreen&&!this.props.shouldShowSplashScreen()?this.props.setShowSplashScreen(!1):!this.props.showSplashScreen&&this.props.isVideoPaused&&this.props.setIsVideoPaused(!1),this.props.errorStatus===c.K.LOADING_SLIDES&&this.props.unSetErrorStatus();const e=I.peek().dts;u.f.sendData(u.c.DATA_DOWNLOADED,g({},this.analyticsDataForMilestone[u.d.DuringDataFileResolve]||{}),{[u.e.Measure1]:e}),v.resolve("AFTER_DATA")}if(this.props.shouldGetReplayToken&&!this.replayDetailsApiDone&&this.getReplayDetails(),!e.isTokenApiDone&&this.props.isTokenApiDone){const e=I.peek().dts;u.f.sendData(u.c.REPLAY_TOKEN_FETCHED,g({},this.analyticsDataForMilestone[u.d.DuringTokenDataResolve]||{}),{[u.e.Measure1]:e}),v.resolve("REPLAY_TOKEN")}if(!e.isLearnerSlideModeActive&&this.props.isLearnerSlideModeActive&&(this.props.unSetBulkUpdate(),this.props.setIsVideoPaused(!0)),e.isLearnerSlideModeActive&&!this.props.isLearnerSlideModeActive){if(this.props.setIsVideoPaused(!1),this.props.shouldResume){let e=D.b.main.slides.getItem(this.props.learnerSlideModeActiveSlide).startTime;e&&this.props.seek(e/1e6),this.props.setResumePlaybackState(!1)}this.props.useGreenScreen&&this.props.startPaintingVideoOnCanvas()}}manageAPIFailureEvents(e){const t=I.peek().dts;e.milestone===u.d.DuringMetaFileResolve?(u.f.sendData(u.c.META_DOWNLOAD_FAILURE,g({},e.data),{[u.e.Measure1]:t}),v.resolve("AFTER_META")):e.milestone===u.d.DuringDataFileResolve?(u.f.sendData(u.c.DATA_DOWNLOAD_FAILURE,g({},e.data),{[u.e.Measure1]:t}),v.resolve("AFTER_DATA")):e.milestone===u.d.DuringTokenDataResolve&&u.f.sendData(u.c.TOKEN_FETCH_FAILURE,g({},e.data),{[u.e.Measure1]:t})}componentWillUnmount(){y.reset(),I.end()}resetUnknownEventState(e,t,s){e.isProfileRunning()&&(e.end(),u.f.sendData(u.c.UNKNOWN_STATE,{fqsource:t,reason:s}))}getReplayDetails(){this.replayDetailsApiDone=!0,this.props.getReplayToken(this.props.apiHost,this.props.lessonId,this.props.accessToken)}getReplayMeta(e){this.props.getReplayMeta(e),this.props.setIsVideoPaused(!0)}afterMeta(e=!1){e&&this.props.startPaintingVideoOnCanvas(),this.props.setShouldSyncChat(D.b.main.shouldSyncChat),this.props.setDataJsonFromReplay(this.dataJson),this.props.shouldAutoplay&&(this.props.shouldSeekToWatchTime()&&(this.props.setHasSeekedToWatchTime(),this.props.onSeekStart(),this.props.seek(this.props.watchTime)),requestAnimationFrame(this.props.frameLoop))}render(){return null}}const O={getReplayToken:l.g,getReplayMeta:l.f,getReplayData:l.e,setErrorStatus:l.I,setShouldSyncChat:l.jb,unSetBulkUpdate:h.f,setShowSplashScreen:l.nb,setIsVideoPaused:d.p,setResumePlaybackState:d.v,setLearnerSlideModeActive:d.r,setLearnerSlideModeActiveSlide:h.d,setAnnotationsOff:d.b,setDarkMode:l.x,setIsChatHidden:d.f,unSetErrorStatus:l.Bb};t.default=Object(n.c)(e=>({isLocal:e.getIn(["app","isLocal"]),slides:e.getIn(["canvas","slides"]),activeSlide:e.getIn(["canvas","activeSlide"]),videoId:e.getIn(["app","videoId"]),shouldGetReplayToken:e.getIn(["app","shouldGetReplayToken"]),lessonId:e.getIn(["app","lessonData","uid"]),useGreenScreen:e.getIn(["app","useGreenScreen"]),shouldAutoplay:e.getIn(["app","shouldAutoplay"]),isTokenApiDone:e.getIn(["app","isTokenApiDone"]),isReplayMetaFetched:e.getIn(["app","isReplayMetaFetched"]),isReplayDataProcessed:e.getIn(["app","isReplayDataProcessed"]),analyticsDebugData:e.getIn(["app","analyticsDebugData"]),apiHost:e.getIn(["app","apiHost"]),accessToken:e.getIn(["app","accessToken"]),watchTime:e.getIn(["app","watchTime"]),showSplashScreen:e.getIn(["app","showSplashScreen"]),isLearnerSlideModeActive:e.getIn(["videoPlayControls","isLearnerSlideModeActive"]),learnerSlideModeActiveSlide:e.getIn(["canvas","learnerSlideModeActiveSlide"]),shouldResume:e.getIn(["videoPlayControls","shouldResumeSlideModePlayback"]),errorStatus:e.getIn(["app","errorStatus"]),isVideoPaused:e.getIn(["videoPlayControls","isVideoPaused"])}),O)(M)}}]);
//# sourceMappingURL=replay.d2629bb6f9c37846c348.chunk.js.map