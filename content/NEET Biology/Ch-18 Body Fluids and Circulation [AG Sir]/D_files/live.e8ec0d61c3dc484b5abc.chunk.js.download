(this["webpackJsonpunacademy-live"]=this["webpackJsonpunacademy-live"]||[]).push([[8],{A00c:function(e,s,t){"use strict";t.r(s);var a=t("o0o1"),n=t.n(a),r=t("yXPU"),o=t.n(r),i=t("lwsE"),p=t.n(i),c=t("W8MJ"),l=t.n(c),d=t("PJYZ"),u=t.n(d),h=t("7W2i"),v=t.n(h),S=t("a1gu"),m=t.n(S),C=t("Nsbk"),g=t.n(C),E=t("lSNA"),D=t.n(E),I=t("q1tI"),f=t.n(I),b=t("/MKj"),y=(t("vDqi"),t("9ONQ")),R=t("gtzJ"),T=t("Pj12"),O=t("ri1g"),w=t("apID"),k=t("oOl7"),P=t("Ocil"),A=t("T7PT"),L=t("qSKu"),M=t("Eyh2"),_=t("jxKE"),N=t("BMd/"),j=t("28oz"),W=t("wCkA"),V=t("hwvQ"),H=t("6YgN"),x=t("XyO8"),B=t("17x9"),F=t.n(B),G=t("vOnD"),J=t("8ezB"),U=t("5K3P"),q=t("tn5L"),z=t("0dbe");const Y=G.d.div.withConfig({displayName:"DevicePermission__PermisisonWrapper",componentId:"qgticn-0"})(["display:flex;flex-direction:column;height:100%;"]),X=G.d.div.withConfig({displayName:"DevicePermission__PersmissionsContainer",componentId:"qgticn-1"})(["display:flex;flex-direction:column;height:100%;margin-top:50px;justify-content:space-between;padding:0 16px;"]),K=G.d.div.withConfig({displayName:"DevicePermission__Permission",componentId:"qgticn-2"})(["display:flex;justify-content:space-between;align-items:center;"]),Z=G.d.div.withConfig({displayName:"DevicePermission__Header",componentId:"qgticn-3"})(["display:flex;flex-direction:column;padding:32px 16px 0 16px;"]),Q=G.d.div.withConfig({displayName:"DevicePermission__Assets",componentId:"qgticn-4"})(["display:flex;align-items:center;"]),$=G.d.div.withConfig({displayName:"DevicePermission__Footer",componentId:"qgticn-5"})(["display:flex;justify-content:flex-end;box-shadow:0px 0px 32px ",";padding:12px;"],({theme:e})=>e.SHADOW),ee=Object(G.d)(x.g).withConfig({displayName:"DevicePermission__StyledDivider",componentId:"qgticn-6"})(["margin:"," 0;"],J.c.SPACING_6B),se=Object(G.d)(x.l).withConfig({displayName:"DevicePermission__AccessText",componentId:"qgticn-7"})(["color:",";"],({granted:e,theme:s})=>e?s.GREEN:s.RED),te=G.d.div.withConfig({displayName:"DevicePermission__DisclaimerWrapper",componentId:"qgticn-8"})(["display:flex;margin-bottom:",";"],J.c.SPACING_12B),ae=(G.d.div.withConfig({displayName:"DevicePermission__Disclaimer",componentId:"qgticn-9"})(["display:flex;"]),G.d.div.withConfig({displayName:"DevicePermission__DisclaimerImageWrapper",componentId:"qgticn-10"})(["display:flex;"]),G.d.div.withConfig({displayName:"DevicePermission__DevicesWrapper",componentId:"qgticn-11"})(["display:flex;flex-direction:column;"])),ne=G.d.div.withConfig({displayName:"DevicePermission__DisclaimerIconWrapper",componentId:"qgticn-12"})(["display:flex;align-self:flex-start;margin-right:",";"],J.c.SPACING_4B),re=G.d.span.withConfig({displayName:"DevicePermission__DisclaimerText",componentId:"qgticn-13"})(["font-size:14px;line-height:150%;color:",";"],({theme:e})=>e.TEXT_PRIMARY),oe=G.d.span.withConfig({displayName:"DevicePermission__DisclaimerBold",componentId:"qgticn-14"})(["font-weight:600;font-size:14px;line-height:150%;"]),ie=Object(G.d)(x.b).withConfig({displayName:"DevicePermission__StyledButton",componentId:"qgticn-15"})(["height:40px;width:100px;"]),pe=f.a.memo(({cameraPermission:e,microphonePermission:s})=>{const t=Object(b.e)(e=>e.getIn(["app","isEducator"])),a=t=>f.a.createElement(K,null,f.a.createElement(Q,null,"mic"===t?f.a.createElement(z.ob,null):f.a.createElement(z.h,null),f.a.createElement(x.l,{fontWeight:J.d.REGULAR,margin:"0 0 0 ".concat(J.c.SPACING_4B)},"mic"==t?_.Ob.MICROPHONE:_.Ob.CAMERA)),f.a.createElement(se,{granted:"mic"==t?s:e},(t=>"mic"==t?s?_.Ob.ALLOWED:_.Ob.NOT_ACCESSIBLE:e?_.Ob.ALLOWED:_.Ob.NOT_ACCESSIBLE)(t)));return f.a.createElement(Y,null,f.a.createElement(Z,null,f.a.createElement(x.l,{margin:"0 0 ".concat(J.c.SPACING_1B," 0")},_.Ob.HEADING),f.a.createElement(x.q,null,_.Ob.DESCRIPTION),f.a.createElement(q.a,null)),f.a.createElement(X,null,f.a.createElement(ae,null,a("mic"),f.a.createElement(ee,null),a("cam")),f.a.createElement(te,null,f.a.createElement(ne,null,f.a.createElement(z.C,null)),f.a.createElement(re,null,f.a.createElement(oe,null,_.Ob.DISCLAIMER_BOLD)," ",_.Ob.DISCLAIMER_NORMAL))),f.a.createElement($,null,f.a.createElement(ie,{variant:"filled",onClick:()=>{U.b.dispatchEvent(U.a.RELOAD_IFRAME)},isEducator:t},_.f.TRY_AGAIN)))});var ce=pe;pe.propTypes={cameraPermission:F.a.bool.isRequired,microphonePermission:F.a.bool.isRequired},pe.defaultProps={cameraPermission:!1,microphonePermission:!1};var le=f.a.memo((function(e){var s=e.preTestType,t=e.isOpen,a=e.cameraPermission,n=e.microphonePermission;return f.a.createElement(x.u,{open:t,animate:"slide",disableEscapeKeyDown:!1,onClose:function(){},width:"100%"},function(){switch(s){case"permissionsAccessDenied":case"permissionsDenied":return f.a.createElement(ce,{cameraPermission:a,microphonePermission:n});case"incompatibleBrowser":return f.a.createElement("div",null)}}())}));le.propTypes={},le.defaultProps={};var de,ue=le,he=t("7bd3"),ve=t("RYsq");function Se(e,s){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);s&&(a=a.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),t.push.apply(t,a)}return t}function me(e){var s=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,a=g()(e);if(s){var n=g()(this).constructor;t=Reflect.construct(a,arguments,n)}else t=a.apply(this,arguments);return m()(this,t)}}var Ce=he.g.getOrCreateProfile("CLICK_TO_VIEW_PROFILE"),ge=(new y.a,function(e){v()(t,e);var s=me(t);function t(e){var a;return p()(this,t),a=s.call(this,e),D()(u()(a),"broadcastStartClass",(function(){a.props.socketManager&&a.props.socketManager.broadcastData({type:_.nc.EDUCATOR_IS_LIVE})})),D()(u()(a),"connectModerator",(function(){a.props.isMultiEduClass&&a.props.isModerator&&(a.props.setModeratorEntry(a.props.apiHost,a.props.classId,a.props.accessToken),a.startJanus())})),D()(u()(a),"canSendData",(function(){return(10!==a.props.classState||a.props.janusWrapper.canSendData())&&a.props.isEducator})),D()(u()(a),"onChangeSlide",(function(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(a.canSendData()){a.props.resetCanvasZoom(),a.props.resetCanvasTranslation();var t=a.props.activeSlide;if("left"===e?0!==a.props.activeSlide&&(t=a.props.activeSlide-1):"right"===e?a.props.activeSlide!==ve.b.main.slides.length-1&&(t=a.props.activeSlide+1):"select"===e&&null!=s&&void 0!=s&&s>=0&&(t=Number(s)),t!=a.props.activeSlide){a.props.setActiveSlide(t),a.props.setCurrentCanvasZoom(t);var n={plugin:_.Rb.DrawingBoardControls,data:{e:_.X.SLIDE_CHANGE,s:t}};a.props.onSendData(n)}}})),D()(u()(a),"checkForSubscriptionDetails",(function(){a.subscriptionInterval=setInterval((function(){if(!a.props.isPollActive&&0!=a.props.classState&&a.props.subscriptionDetailsArray.length>0)for(var e=0;e<a.props.subscriptionDetailsArray.length;e++){var s,t,n=a.props.subscriptionDetailsArray.getItem(e),r=n.offset,o=(new Date).getTime(),i=(null===(s=a.props.lessonData)||void 0===s||null===(t=s.startedAt)||void 0===t?void 0:t.getTime())||o,p=Math.round((o-i)/1e3);if(r>=p-_.qc&&r<=p){var c=n.getJS();a.props.socketManager&&a.props.socketManager.broadcastData(c);break}}}),_.pc)})),D()(u()(a),"eraseAll",(function(){if(a.canSendData()){var e={e:_.X.ERASE_ALL},s={plugin:_.Rb.CanvasWrapper,data:{id:a.props.activeSlide,data:e}};a.props.onSendData(s),a.props.onReceiveCanvasWrapperData(new V.a(s))}})),D()(u()(a),"getLiveClassDetails",(function(){a.liveDetailsApiDone=!0;var e={headers:{Authorization:"Bearer ".concat(a.props.accessToken)}};a.props.learnerName&&(e.params={teach_user_name:a.props.learnerName}),a.props.fetchLiveClassDetails(a.props.apiHost,a.props.lessonData.uid,e)})),D()(u()(a),"onApplyTheme",(function(e){a.props.onApplyTheme(e)})),D()(u()(a),"checkIfPermissionsGiven",(function(){var e=Object(W.zb)("audio"),s=Object(W.zb)("video");Promise.all([e,s]).then((function(e){a.microphonePermission=e[0],a.cameraPermission=e[1],!1===a.microphonePermission||!1===a.cameraPermission?a.setState({isModalOpen:!0,modalType:"preTest",preTestType:"permissionsDenied"}):"NotReadableError"===a.microphonePermission||"NotReadableError"===a.cameraPermission?a.setState({isModalOpen:!0,modalType:"preTest",preTestType:"permissionsAccessDenied"}):["permissionsDenied","permissionsAccessDenied"].includes(a.state.preTestType)&&a.setState({isModalOpen:!1})}))})),D()(u()(a),"initializeVideoStreamManager",(function(){a.props.videoStreamManager.setForUseStreaming(a.state.useStreaming)})),D()(u()(a),"initializeJanusWrapper",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.janusData;N.a.shared.setUp(e,Object.assign(a.props.lessonData.getJS(),{activeSlide:a.props.activeSlide,role:a.props.role,version:a.props.version,bulkUpdate:a.props.bulkUpdate}),a.props.cameraDeviceId,a.props.microphoneDeviceId,a.props.useRoundVideo),a.props.initialiseJanusWrapper(N.a.shared)})),D()(u()(a),"onReceiveJanusWrapper",(function(){a.state.shouldTurnOffCameraOnStartClass&&a.props.janusWrapper.toggleCamera(),window.j=a.props.janusWrapper,a.setupJanusWrapperListeners()})),D()(u()(a),"changeRestoreState",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=arguments.length>1?arguments[1]:void 0;e&&s?a.onRestoreBegin():e&&!a.props.bulkUpdate&&a.props.setDataRestoring(!0,a.props.isEducator||a.props.isModerator),!e&&a.props.bulkUpdate&&(a.props.setDataRestoring(!1),a.onRestoreEnd())})),D()(u()(a),"playLiveVideo",(function(e){if(!a.playVideoRequested){a.playVideoRequested=!0;var s=e.play();void 0!==s&&s.then((function(){a.pauseErrorHandled=!1,a.playVideoRequested=!1,a.props.sendEvent(U.a.PLAY),a.props.setShowPlayButton(!1)})).catch((function(e){a.playVideoRequested=!1,a.props.sendEvent(U.a.PAUSE),a.props.isEducator&&a.pauseErrorHandled||a.props.isLiveDVR||(clearTimeout(a.autoplayTimer),a.autoplayTimer=setTimeout((function(){console.log("autoplay live error"+e),a.props.setShowPlayButton(!0)}),200))}))}})),D()(u()(a),"setupJanusWrapperListeners",(function(){20!==a.props.classState&&(a.props.janusWrapper.addConnectionListener((function(e){20!==a.props.classState&&(a.props.setConnectionState(e),e===_.lc.CONNECTED&&(a.props.isEducator?(window.webRTCTemp={bytesSent:0,packetsSent:0,nackCount:0},a.getPublisherVideoStats()):(window.webRTCTemp={packetsLost:0,packetsReceived:0,nackCount:0},a.getSubscriberVideoStats())),10===a.props.classState&&e===_.lc.CONNECTED&&a.onConnect(),20===a.props.classState&&(a.props.sendEvent(U.a.FINISHED),a.props.setIsVideoPaused(!0),a.props.isFullScreenEnabled&&a.props.fullScreenHandler()),e===_.lc.CONNECTED||e===_.lc.INIT||10!==a.props.classState||a.isConnectedFirstTime||a.props.setErrorStatus(_.W.CONNECTION_STATE),0!==a.props.classState||a.props.isEducator||a.props.setErrorStatus(_.W.NOT_STARTED),e!==_.lc.CONNECTED||a.props.isEducator||0!==a.props.classState||(a.onConnect(),a.unsetErrorStatus(),a.props.isModerator&&a.props.isMultiEduClass?a.props.setStartClass():a.props.setClassState(10)),e!==_.lc.CONNECTED||10!==a.props.classState||a.props.isScreenShared||a.unsetErrorStatus())})),a.props.janusWrapper.addMultiTabListener((function(){a.props.setErrorStatus(_.W.CONNECTED_IN_DIFF_TAB),a.props.socketManager&&(a.props.socketManager.unSubscribe(),a.props.socketManager.close())})),a.props.janusWrapper.addSlowLinkListener((function(){a.props.onSlowLink&&a.props.onSlowLink()})),a.props.janusWrapper.addRestoreChangeListener((function(e){var s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];a.changeRestoreState(e,s)})),a.props.janusWrapper.addResetListener((function(){a.lastEventTime=0,a.props.reset(),a.props.isLiveDVR&&a.props.setLiveDVR(!1)})),a.props.janusWrapper.addVideoPlayListener((function(){try{a.props.useGreenScreen&&a.props.startPaintingVideoOnCanvas();var e=null;(e=(a.props.isEducator,document.getElementById("screenvideo")))&&(e.onpause=function(s){a.props.isLiveDVR||(a.pauseErrorHandled=!0,a.playLiveVideo(e))},e.onerror=function(e){if(!a.props.isEducator){var s="ErrorType=".concat(e.type,";");he.g.sendData(he.c.VIDEO_ERROR,s)}},e.onplaying=function(){a.playButtonShown=!0,clearTimeout(a.autoplayTimer),a.props.setShowPlayButton(!1)},a.props.isEducator||a.props.shouldAutoplay?a.playLiveVideo(e):a.playButtonShown?(a.props.sendEvent(U.a.PLAY),a.playLiveVideo(e)):(a.props.sendEvent(U.a.PAUSE),a.props.setShowPlayButton(!0)))}catch(s){console.error(s)}})),a.props.janusWrapper.addHistoryUpdatedListener((function(){if(a.props.isEducator){a.props.sendStartEvents((function(){a.lastEventTime=(new Date).getTime()}));var e=Object(W.y)();a.props.onSendData(e,!0),a.startSendingSyncEvents()}a.props.setIsLiveHistoryFetched(!0)})),a.props.janusWrapper.addDataListener((function(e){a.lastEventTime=e[_.X.CURRENT_TIME],a.props.onReceiveData(e,a.props)})),!a.props.isModerator||a.props.wasGoLiveClickedbyGuest?a.startJanus():(a.props.setConnectionState(_.lc.WAITING_FOR_EDUCATOR),a.props.setErrorStatus(_.W.NOT_STARTED)))})),D()(u()(a),"startJanus",(function(){a.props.janusWrapper&&(a.props.isMultiEduClass&&a.props.isModerator?a.props.janusWrapper.startMultiplePublisherSession():a.props.janusWrapper.start())})),D()(u()(a),"onStart",(function(){a.props.useSpeedTest?a.setModalState(null,!0,"preTest","bandwidth"):a.onStartClass()})),D()(u()(a),"sendSyncEvent",(function(){if(a.canSendData()){var e=Object(W.fb)();a.props.onSendData(e,!0)}})),D()(u()(a),"startSendingSyncEvents",(function(){clearInterval(a.syncEventInterval),a.syncEventInterval=setInterval(a.sendSyncEvent,_.tc)})),D()(u()(a),"sendEventsOnStart",(function(){var e={plugin:_.Rb.Control,data:{e:_.X.GREEN_SCREEN,v:a.props.useGreenScreen?a.props.useGreenScreen:0}};a.props.onSendData(e);var s={plugin:_.Rb.Control,data:{data:{e:_.X.CAMERA_ONLY_CLASS,b:a.props.isCanvasModeDisabled}}};a.props.onSendData(s);var t=_.t.VIDEO_MODES.CONFIG_KEY,n=_.t.VIDEO_MODES.NORMAL_MODE,r=D()({},t,n);a.props.useGreenScreen?(r[_.t.CAMERA_RATIO]=_.I.DEFAULT,r[t]=n=_.t.VIDEO_MODES.GREEN_SCREEN):a.props.useRoundVideo&&(r[t]=n=_.t.VIDEO_MODES.ROUND_VIDEO,he.g.sendData(he.c.ROUND_VIDEO_SELECTED)),he.g.sendData(he.c.VIDEO_MODE,n);var o=Object(W.x)(r);a.props.onSendData(o);var i=Object(W.t)(a.props.cameraRatio);a.props.onSendData(i)})),D()(u()(a),"onStartClass",(function(){a.sendEventsOnStart(),"WO7LDJ3Y2Z"!==a.props.userId&&a.props.socketManager&&a.props.socketManager.setClassConfiguration({questionsEnabled:!0});var e=a.props.useGreenScreen?a.props.useGreenScreen:0;a.janusData&&(a.janusData=a.janusData.setUseChroma(e)),a.broadcastStartClass(),a.props.postStartClassState(a.props.apiHost,a.props.lessonData.uid,a.props.version,e,a.props.accessToken)})),D()(u()(a),"onEndClass",o()(n.a.mark((function e(){var s;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!a.props.isScreenShared){e.next=4;break}return e.next=4,a.props.stopScreenShareHandler();case 4:s={plugin:_.Rb.Control,data:{e:_.X.CLASS_END}},a.props.resetCanvasZoom(),a.props.resetCanvasTranslation(),a.props.onSendData(s),a.props.setClassEndState(),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.error(e.t0);case 14:return e.prev=14,a.props.janusWrapper&&a.props.janusWrapper.disconectJanus(!0),e.finish(14);case 17:a.props.postEndClassState(a.props.apiHost,a.props.lessonData.uid,a.props.accessToken),a.props.socketManager&&a.props.socketManager.sendClassFinish();case 19:case"end":return e.stop()}}),e,null,[[0,11,14,17]])})))),D()(u()(a),"addSlide",(function(e,s,t){a.props.onAddSlide(s,t)})),D()(u()(a),"setPreTestType",(function(e){a.setState({preTestType:e})})),D()(u()(a),"toggleCameraPreClass",(function(){a.setState((function(e,s){return{shouldTurnOffCameraOnStartClass:!e.shouldTurnOffCameraOnStartClass}}))})),D()(u()(a),"setModalState",(function(e,s,t){a.setState({isModalOpen:e,preTestType:t,modalType:s})})),a.janusData=null,a.isConnectedFirstTime=!1,a.lastEventTime=0,a.state={isModalOpen:!1,preTestType:"",modalType:""},a.playIndex=0,a.localStorage=new H.a,window.onbeforeunload=a.updateRefreshEvent(),window.useUaDocForImages=1,a.getVideoStatsInterval=null,a.playVideoRequested=!1,a.connectJanusCalled=!1,Ce.isProfileRunning()&&(Ce.reset(),he.g.sendData(he.c.UNKNOWN_STATE,{fqsource:"clickToViewProfile",reason:"profile is running before start up while it should not"})),Ce.start(),a}return l()(t,[{key:"UNSAFE_componentWillMount",value:function(){this.props.localData&&this.props.setUpJanusData(this.props.localData)}},{key:"componentDidMount",value:function(){this.props.shouldGetLiveClassDetails&&this.getLiveClassDetails()}},{key:"componentDidUpdate",value:function(e){var s;(this.props.isTokenApiDone&&!e.isTokenApiDone&&(0===this.props.classState&&this.props.setDefaultStartEvents(),this.setupJanusUtil()),(this.shouldConnectEducatorJanus(e)||this.shouldConnectModeratorjanus(e))&&this.connectJanus(this.janusData),this.props.janusWrapper&&!e.janusWrapper&&this.props.isJanusWrapperInit&&this.onReceiveJanusWrapper(),this.props.shouldGetLiveClassDetails&&!this.liveDetailsApiDone&&this.getLiveClassDetails(),this.props.addWebRTCEventData&&!e.addWebRTCEventData&&this.addWebRTCEvent(this.props.addWebRTCEventData),this.props.startClassClicked&&!e.startClassClicked&&(this.props.isEducator&&this.onStart(),this.props.isMultiEduClass&&this.props.isModerator&&this.connectModerator()),this.props.endClassClicked&&!e.endClassClicked&&this.onEndClass(),this.props.isLiveHistoryFetched&&!e.isLiveHistoryFetched&&this.props.showSplashScreen&&!this.props.shouldShowSplashScreen()&&this.props.setShowSplashScreen(!1),this.props.subscriptionDetailsArray.length!==e.subscriptionDetailsArray.length&&this.props.isSpecial&&this.checkForSubscriptionDetails(),this.props.useRoundVideo!==e.useRoundVideo&&this.props.janusWrapper&&(this.props.janusWrapper.setUseRoundVideo(this.props.useRoundVideo),this.props.janusWrapper.reconnect("ROUND_VIDEO_MODE_SWITCH",null,!0,!1)),10===e.classState&&20===this.props.classState&&this.props.learnerInCall&&this.props.setLearnerInCall(!1),10!==e.classState||20!==this.props.classState||this.props.isEducator||this.props.setRaiseHandEnabled(!1),20===this.props.classState&&this.props.isEducator&&!this.props.isChatViewHidden&&this.props.setIsChatViewHidden(!0),20!==e.classState&&20===this.props.classState&&this.props.approvedRaisedHand&&this.props.socketManager.sendRejectRaisedHand(this.props.approvedRaisedHand.requestId),!e.learnerInCall&&this.props.learnerInCall)&&(this.props.isEducator||N.a.shared.enableMic(),N.a.shared.startMultiplePublisherSession(!this.props.isEducator,this.props.isEducator?this.props.approvedRaisedHand.feedId:null===(s=this.props.janusData)||void 0===s?void 0:s.learnerFeedId,!this.props.isEducator,!1));e.learnerInCall&&!this.props.learnerInCall&&N.a.shared.endMultiplePublisherSession()}},{key:"componentWillUnmount",value:function(){clearInterval(this.getVideoStatsInterval),clearInterval(this.subscriptionInterval),clearInterval(this.syncEventInterval)}},{key:"shouldConnectEducatorJanus",value:function(e){return 10===this.props.classState&&!e.janusWrapper&&this.props.isEducator&&this.props.microphoneDeviceId&&this.props.cameraDeviceId&&!this.connectJanusCalled}},{key:"shouldConnectModeratorjanus",value:function(e){return!e.janusWrapper&&!this.props.isEducator&&this.props.isMultiEduClass&&this.props.isModerator&&this.props.microphoneDeviceId&&this.props.cameraDeviceId&&!this.connectJanusCalled}},{key:"getSubscriberVideoStats",value:function(){var e=this;clearInterval(this.getVideoStatsInterval),this.getVideoStatsInterval=setInterval((function(){Object(W.eb)(e.props.janusWrapper).then((function(s){var t=s.packetsLostC,a=s.packetsReceivedC,n=s.nackCountC,r=s.bitRate;window.ua&&Object(W.Hb)("webrtcStats",{nackCountC:n,role:e.props.role,Version:e.props.version}),e.addWebRTCEvent({packetsLost:t,packetsReceived:a,nackCount:n,bitRate:r,type:"SUBSCRIBER"})})).catch((function(){}))}),5e3)}},{key:"getPublisherVideoStats",value:function(){var e=this;clearInterval(this.getVideoStatsInterval),this.getVideoStatsInterval=setInterval((function(){Object(W.X)(e.props.janusWrapper).then((function(s){var t=s.bytesSentC,a=s.packetsSentC,n=s.nackCountC;window.ua&&Object(W.Hb)("webrtcStats",{nackCountC:n,Version:e.props.version}),e.addWebRTCEvent({bytesSent:t,packetsSent:a,nackCount:n,type:"PUBLISHER"})})).catch((function(){}))}),5e3)}},{key:"addWebRTCEvent",value:function(e){if(window.webRTCEvents&&window.webRTCEvents.length>=12){window.webRTCEvents.slice(0);window.webRTCEvents=[],this.eventTime=(new Date).getTime()}window.webRTCEvents.push(function(e){for(var s=1;s<arguments.length;s++){var t=null!=arguments[s]?arguments[s]:{};s%2?Se(Object(t),!0).forEach((function(s){D()(e,s,t[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Se(Object(t)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(t,s))}))}return e}({classId:this.janusData.classId,time:(new Date).getTime()},e)),this.props.addWebRTCEventData&&this.props.setStateFromChildren({addWebRTCEventData:null})}},{key:"sendRefreshEvent",value:function(){}},{key:"updateRefreshEvent",value:function(){this.localStorage.setItem("refresh",!0)}},{key:"removeRefreshEvent",value:function(){this.localStorage.setItem("refresh",!1)}},{key:"setupJanusUtil",value:function(){var e=this;window.ua&&Object(W.Kb)(this.props.userId),(this.props.isEducator||this.props.isMultiEduClass&&this.props.isModerator)&&(this.checkIfPermissionsGiven(),j.a.init(),j.a.listDevices((function(s){e.props.setDevices(s)}))),window.useUaDocForImages=this.props.useUaDoc,this.initializeVideoStreamManager(),this.props.initialiseHeaderControlsVisibilityTimeout(),this.janusData=this.props.janusData.mergeAttributes({useChroma:this.props.useGreenScreen,useStreaming:this.props.useStreaming}),this.props.useGreenScreen&&this.props.startPaintingVideoOnCanvas(),this.props.isEducator||this.props.isModerator||this.connectJanus(this.janusData),R.b({id:this.janusData.uid,name:this.janusData.name}),this.sendRefreshEvent(),this.props.isEducator&&this.props.isSpecial&&this.props.fetchSpecialClassSubscriptionDetails(this.props.apiHost,this.props.classId,this.props.accessToken)}},{key:"connectJanus",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.janusData;this.props.isJanusWrapperInit||this.initializeJanusWrapper(e),this.connectJanusCalled=!0}},{key:"onConnect",value:function(){this.props.sendEvent(U.a.LIVE),this.props.sendEvent(U.a.PLAY),this.props.setIsVideoPaused(!1),this.props.isJanusClass&&!this.props.isEducator&&this.props.getHlsLiveDuration(),this.isConnectedFirstTime=!0}},{key:"onRestoreBegin",value:function(){this.props.isEducator||this.props.isModerator||this.props.setErrorStatus(_.W.LOADING_SLIDES)}},{key:"onRestoreEnd",value:function(){this.props.errorStatus===_.W.LOADING_SLIDES&&this.props.unSetErrorStatus(),this.props.setIsLiveDataProcessed()}},{key:"unsetErrorStatus",value:function(){this.props.errorStatus!==_.W.LOADING_SLIDES&&this.props.unSetErrorStatus()}},{key:"render",value:function(){return f.a.createElement(ue,{isOpen:this.state.isModalOpen,cameraPermission:this.cameraPermission,microphonePermission:this.microphonePermission,preTestType:this.state.preTestType})}}]),t}(f.a.PureComponent)),Ee=(de={setDrawingModeInStore:T.e,setPenStrokeSize:T.i,setColorChange:T.c,setEraserStrokeSize:T.h,setTheme:T.k,setDevices:O.B,setUpJanusData:O.Ab,fetchLiveClassDetails:O.c,setErrorStatus:O.M,setLoading:O.eb,setConnectionState:O.z},D()(de,"setErrorStatus",O.M),D()(de,"unSetErrorStatus",O.Ib),D()(de,"setShowPlayButton",O.sb),D()(de,"postStartClassState",O.l),D()(de,"postEndClassState",O.k),D()(de,"setCameraDeviceId",O.p),D()(de,"setMicrophoneDeviceId",O.fb),D()(de,"setDevicesFromCookies",O.C),D()(de,"setActiveSlide",w.a),D()(de,"setDataRestoring",w.b),D()(de,"setEndClassClicked",O.K),D()(de,"setCurrentCanvasZoom",T.d),D()(de,"setInfoBannerStatus",O.R),D()(de,"setShowSplashScreen",O.ub),D()(de,"setIsLiveHistoryFetched",O.Y),D()(de,"setClassState",O.w),D()(de,"setIsVideoPaused",P.o),D()(de,"fetchSpecialClassSubscriptionDetails",k.a),D()(de,"setStartClass",O.xb),D()(de,"setModeratorEntry",O.gb),D()(de,"setLiveDVR",L.d),D()(de,"setIsLiveDataProcessed",O.X),D()(de,"setRaiseHandEnabled",M.q),D()(de,"setIsChatViewHidden",A.a),D()(de,"setLearnerInCall",M.o),de);s.default=Object(b.c)((function(e){return{userId:e.getIn(["app","userId"]),drawingMode:e.getIn(["drawingBoardControls","drawingMode"]),penStrokeSize:e.getIn(["drawingBoardControls","penStrokeSize"]),markerColor:e.getIn(["drawingBoardControls","markerColor"]),eraserStrokeSize:e.getIn(["drawingBoardControls","eraserStrokeSize"]),theme:e.getIn(["drawingBoardControls","theme"]),isTokenApiDone:e.getIn(["app","isTokenApiDone"]),classState:e.getIn(["app","classState"]),isEducator:e.getIn(["app","isEducator"]),useUaDoc:e.getIn(["app","useUaDoc"]),janusData:e.getIn(["app","janusData"]),jwt:e.getIn(["app","jwt"]),useSpeedTest:e.getIn(["app","useSpeedTest"]),useStreaming:e.getIn(["app","useStreaming"]),useRoundVideo:e.getIn(["app","useRoundVideo"]),isCanvasStreaming:e.getIn(["app","isCanvasStreaming"]),isCanvasModeDisabled:e.getIn(["app","isCanvasModeDisabled"]),classDuration:e.getIn(["app","classDuration"]),lessonData:e.getIn(["app","lessonData"]),classId:e.getIn(["app","classId"]),role:e.getIn(["app","role"]),apiHost:e.getIn(["app","apiHost"]),accessToken:e.getIn(["app","accessToken"]),localData:e.getIn(["app","localData"]),isJanusClass:e.getIn(["app","isJanusClass"]),isLoading:e.getIn(["app","isLoading"]),useGreenScreen:e.getIn(["app","useGreenScreen"]),shouldAutoplay:e.getIn(["app","shouldAutoplay"]),version:e.getIn(["app","version"]),isSpecial:e.getIn(["app","isSpecial"]),learnerName:e.getIn(["app","learnerName"]),cameraDeviceId:e.getIn(["app","cameraDeviceId"]),microphoneDeviceId:e.getIn(["app","microphoneDeviceId"]),shouldGetLiveClassDetails:e.getIn(["app","shouldGetLiveClassDetails"]),startClassClicked:e.getIn(["app","startClassClicked"]),endClassClicked:e.getIn(["app","endClassClicked"]),showSplashScreen:e.getIn(["app","showSplashScreen"]),isJanusWrapperInit:e.getIn(["app","isJanusWrapperInit"]),isLiveHistoryFetched:e.getIn(["app","isLiveHistoryFetched"]),isModerator:e.getIn(["app","isModerator"]),isMultiEduClass:e.getIn(["app","isMultiEduClass"]),isChatFocused:e.getIn(["chat","isChatFocused"]),activeSlide:e.getIn(["canvas","activeSlide"]),slides:e.getIn(["canvas","slides"]),bulkUpdate:e.getIn(["canvas","bulkUpdate"]),isReportInputFocussed:e.getIn(["videoPlayControls","isReportInputFocussed"]),isChatReportBlockFocused:e.getIn(["chat","isChatReportBlockFocused"]),isLiveDVR:e.getIn(["videoPlayControls","isLiveDVR"]),isFullScreenEnabled:e.getIn(["videoPlayControls","isFullScreenEnabled"]),isChatViewHidden:e.getIn(["sidebar","isChatViewHidden"]),subscriptionDetailsArray:e.getIn(["subscription","subscriptionDetailsArray"]),isPollActive:e.getIn(["poll","isPollActive"]),classConfig:e.getIn(["app","classConfig"]),wasGoLiveClickedbyGuest:e.getIn(["app","wasGoLiveClickedbyGuest"]),errorStatus:e.getIn(["app","errorStatus"]),cameraRatio:e.getIn(["app","cameraRatio"]),learnerInCall:e.getIn(["raiseHand","learnerInCall"]),approvedRaisedHand:e.getIn(["raiseHand","approvedRaisedHand"]),isRaiseHandEnabled:e.getIn(["raiseHand","isRaiseHandEnabled"]),isNotesEnabledForUser:e.getIn(["app","isNotesEnabledForUser"]),notesAccessToken:e.getIn(["app","noteAccessToken"])}}),Ee,null,{forwardRef:!0})(ge)}}]);
//# sourceMappingURL=live.e8ec0d61c3dc484b5abc.chunk.js.map