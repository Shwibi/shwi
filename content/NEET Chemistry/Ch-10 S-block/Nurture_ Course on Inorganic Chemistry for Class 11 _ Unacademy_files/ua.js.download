function getHiddenProp(){var n=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var e=0;e<n.length;e++)if(n[e]+"Hidden"in document)return n[e]+"Hidden";return null}function isHidden(){var n=getHiddenProp();return n?document[n]:!1}function makeRequest(n,e,t,o){var r=new(this.XMLHttpRequest||XDomainRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0"),i=o?"PUT":"GET",a="https://data.unacademy.com";r.open(i,a+n,!0);for(var u in e)r.setRequestHeader(u,e[u]);r.onreadystatechange=function(){var n=4,e=200;return r.readyState===n?r.status===e?t(null,r.responseText):401===r.status?t(null,void 0,401):t(new Error("non OK response"+r.status)):void 0},r.send(o)}function setCookie(n,e){document.cookie=[n,e].join("=")}function getCookies(n){var e="(?:(?:^|.*;\\s*)"+n+"\\s*\\=\\s*([^;]*).*$)|^.*$";return document.cookie.replace(new RegExp(e),"$1")}function makeExtraDataStr(n){var e={};for(var t in n)e[t]=n[t];return e}function Storage(){var n={};this.get=function(e){return _hasLocalStorageSupport_?window.localStorage.getItem(e):n[e]},this.set=function(e,t){return _hasLocalStorageSupport_?window.localStorage.setItem(e,t):n[e]=t}}function UnacademyAnalytics(){function n(n,e){var t=h.get("_buff_");return t?JSON.parse(t):[]}function e(n){return p=n.length,h.set("_buff_",JSON.stringify(n))}function t(t,o){var r=n();return e(r.slice(o)),r.splice(t,o)}function o(t){Array.isArray(t)||(t=[t]);var o=n();return o=o.concat(t),e(o),o}function r(){return isHidden()?f(0,p):void 0}function i(n,e,t){if(e[eventVar]=n,e[valueVar]=t,v)e[userIdVar]=""+v;else{if(!g)return void s(function(){});e[anonymousIdVar]=g}return e}function a(n){return{events:n}}function u(){return _?{accesstoken:l,authorization:"Bearer "+_}:c(function(){})}function c(n){makeRequest("/access_token_secret",{accesstoken:l},function(e,t,o){return e?n(e):(_=t.toString(),n(null))})}function s(n){if(""!==g||v)return n(null);var e=u();return e?void makeRequest("/anonymous_id",e,function(e,t,o){if(e)return n(e);t=t.toString();try{t=JSON.parse(t)}catch(r){return n(r)}return g=t[anonymousIdVar],setCookie(anonymousIdCookie,g),n(null)}):n(new Error("anonymous_id is not present"))}function d(n,e,t){if(n){n=["frontend",n].join("_");var o=e&&"[object Object]"===e.toString()?makeExtraDataStr(e):{};return t=+t||1,o.time=Date.now(),i(n,o,t)}}function f(n,e,r){if(r=r||function(){},n=+n,isNaN(n))return r(new Error("start should be integer"));if(e=+e,isNaN(e)&&(e=p),events=t(n,e),!Array.isArray(events)||0===events.length)return r(null);var i=u()||{};i["Content-Type"]="application/json",makeRequest("/counts",i,function(n,e,t){return t>399&&!n&&o(events),n?r(n):401!==t?r(n):void c(function(e,t){return e?r(n):void s(function(e,t){return r(n)})})},JSON.stringify(a(events)))}var l,v,_,p=0,h=new Storage,g=getCookies(anonymousIdCookie);this.initiated=!1,setInterval(function(){f(0,p)},2e4);var m=getHiddenProp();if(m){var y=m.replace(/[H|h]idden/,"")+"visibilitychange";document.addEventListener(y,r)}else window.onbeforeunload=function(n){return f(0,p)},window.addEventListener("pagehide",function(){return f(0,p)});this.count=function(n,e,t){t=t||{};var r=t.value,i=t.force;n&&(n=d(n,e,r),n&&(o(n),end=-1,(p>=countBatch||i)&&(end=i?p:countBatch),end>0&&f(0,end,function(n,e){n&&console.error("error while counting events!!!")})))},this.init=function(n,e,t){if(!n)return t(!0);l=n,v=e;var o=this;c(function(n,e){return n?t(n):void s(function(n){return n?t(n):(o.initiated=!0,t(null))})})}}function UA(){var n=arguments[0],e=[].slice.call(arguments,1);if("create"===n){if(!e[0])return void console.log("must provide accesstoken");e[1]=e[1]||void 0,e[2]=_handleInit;try{_UA.init.apply(_UA,e)}catch(t){console.error("init failed",t)}}else if("send"===n){if(!_UA.initiated)return _buff.length>countBatch&&(_buff=_buff.slice(1,countBatch)),void _buff.push(arguments);try{_UA.count.apply(_UA,e)}catch(t){console.error("event sent failed",t)}}}function _cleanUp(n){for(var e=0;e<n.length;e++)UA.apply(void 0,[].splice.call(n[e],0))}var _hasLocalStorageSupport_=!1;try{window.localStorage.setItem("_t_","_t_"),window.localStorage.removeItem("_t_"),_hasLocalStorageSupport_=!0}catch(e){_hasLocalStorageSupport_=!1}var eventVar="event",valueVar="value",userIdVar="user_id",anonymousIdVar="anonymous_id",anonymousIdCookie="_anonymous_id",countBatch=10,_UA=new UnacademyAnalytics,_buff=[],_handleInit=function(n){n&&console.log("unable to initialize ua",n),_cleanUp(_buff),_buff=[]};window.ua&&_cleanUp(window.ua.q||[]),window.ua=UA;
